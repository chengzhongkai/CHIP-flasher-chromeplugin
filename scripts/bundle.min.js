!function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){var r=t[s][1][e];return i(r?r:e)},l,l.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){(function(e,n){!function(e){if("object"==typeof r&&"undefined"!=typeof t)t.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i;"undefined"!=typeof window?i=window:"undefined"!=typeof n?i=n:"undefined"!=typeof self&&(i=self),i.Promise=e()}}(function(){var t,r,i;return function o(e,t,r){function n(s,a){if(!t[s]){if(!e[s]){var u="function"==typeof _dereq_&&_dereq_;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=t[s]={exports:{}};e[s][0].call(l.exports,function(t){var r=e[s][1][t];return n(r?r:t)},l,l.exports,o,e,t,r)}return t[s].exports}for(var i="function"==typeof _dereq_&&_dereq_,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(e,t,r){"use strict";t.exports=function(e){function t(e){var t=new r(e),n=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),n}var r=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],2:[function(t,r,n){"use strict";function i(){this._isTickUsed=!1,this._lateQueue=new h(16),this._normalQueue=new h(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=l}function o(e,t,r){this._lateQueue.push(e,t,r),this._queueTick()}function s(e,t,r){this._normalQueue.push(e,t,r),this._queueTick()}function a(e){this._normalQueue._pushOne(e),this._queueTick()}var u;try{throw new Error}catch(c){u=c}var l=t("./schedule"),h=t("./queue"),f=t("./util");i.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},i.prototype.disableTrampolineIfNecessary=function(){f.hasDevTools&&(this._trampolineEnabled=!1)},i.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},i.prototype.fatalError=function(t,r){r?(e.stderr.write("Fatal "+(t instanceof Error?t.stack:t)+"\n"),e.exit(2)):this.throwLater(t)},i.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(r){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},f.hasDevTools?(i.prototype.invokeLater=function(e,t,r){this._trampolineEnabled?o.call(this,e,t,r):this._schedule(function(){setTimeout(function(){e.call(t,r)},100)})},i.prototype.invoke=function(e,t,r){this._trampolineEnabled?s.call(this,e,t,r):this._schedule(function(){e.call(t,r)})},i.prototype.settlePromises=function(e){this._trampolineEnabled?a.call(this,e):this._schedule(function(){e._settlePromises()})}):(i.prototype.invokeLater=o,i.prototype.invoke=s,i.prototype.settlePromises=a),i.prototype.invokeFirst=function(e,t,r){this._normalQueue.unshift(e,t,r),this._queueTick()},i.prototype._drainQueue=function(e){for(;e.length()>0;){var t=e.shift();if("function"==typeof t){var r=e.shift(),n=e.shift();t.call(r,n)}else t._settlePromises()}},i.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},i.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},i.prototype._reset=function(){this._isTickUsed=!1},r.exports=i,r.exports.firstLineError=u},{"./queue":26,"./schedule":29,"./util":36}],3:[function(e,t,r){"use strict";t.exports=function(e,t,r,n){var i=!1,o=function(e,t){this._reject(t)},s=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(o,o,null,this,e)},a=function(e,t){0===(50397184&this._bitField)&&this._resolveCallback(t.target)},u=function(e,t){t.promiseRejectionQueued||this._reject(e)};e.prototype.bind=function(o){i||(i=!0,e.prototype._propagateFrom=n.propagateFromFunction(),e.prototype._boundValue=n.boundValueFunction());var c=r(o),l=new e(t);l._propagateFrom(this,1);var h=this._target();if(l._setBoundTo(c),c instanceof e){var f={promiseRejectionQueued:!1,promise:l,target:h,bindingPromise:c};h._then(t,s,void 0,l,f),c._then(a,u,void 0,l,f),l._setOnCancel(c)}else l._resolveCallback(h);return l},e.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=-2097153&this._bitField},e.prototype._isBound=function(){return 2097152===(2097152&this._bitField)},e.bind=function(t,r){return e.resolve(r).bind(t)}}},{}],4:[function(e,t,r){"use strict";function n(){try{Promise===o&&(Promise=i)}catch(e){}return o}var i;"undefined"!=typeof Promise&&(i=Promise);var o=e("./promise")();o.noConflict=n,t.exports=o},{"./promise":22}],5:[function(e,t,r){"use strict";var n=Object.create;if(n){var i=n(null),o=n(null);i[" size"]=o[" size"]=0}t.exports=function(t){function r(e,r){var n;if(null!=e&&(n=e[r]),"function"!=typeof n){var i="Object "+a.classString(e)+" has no method '"+a.toString(r)+"'";throw new t.TypeError(i)}return n}function n(e){var t=this.pop(),n=r(e,t);return n.apply(e,this)}function i(e){return e[this]}function o(e){var t=+this;return 0>t&&(t=Math.max(0,t+e.length)),e[t]}var s,a=e("./util"),u=a.canEvaluate;a.isIdentifier;t.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(n,void 0,void 0,t,void 0)},t.prototype.get=function(e){var t,r="number"==typeof e;if(r)t=o;else if(u){var n=s(e);t=null!==n?n:i}else t=i;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(e,t,r){"use strict";t.exports=function(t,r,n,i){var o=e("./util"),s=o.tryCatch,a=o.errorObj,u=t._async;t.prototype["break"]=t.prototype.cancel=function(){if(!i.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e.isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var r=e._cancellationParent;if(null==r||!r.isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),t=e,e=r}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),this._enoughBranchesHaveCancelled()?(this._invokeOnCancel(),!0):!1)},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this.isCancellable()&&(this._setCancelled(),u.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(e,t){if(o.isArray(e))for(var r=0;r<e.length;++r)this._doInvokeOnCancel(e[r],t);else if(void 0!==e)if("function"==typeof e){if(!t){var n=s(e).call(this._boundValue());n===a&&(this._attachExtraTrace(n.e),u.throwLater(n.e))}}else e._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),u.invoke(this._doInvokeOnCancel,this,e)},t.prototype._invokeInternalOnCancel=function(){this.isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t,r){"use strict";t.exports=function(t){function r(e,r,a){return function(u){var c=a._boundValue();e:for(var l=0;l<e.length;++l){var h=e[l];if(h===Error||null!=h&&h.prototype instanceof Error){if(u instanceof h)return o(r).call(c,u)}else if("function"==typeof h){var f=o(h).call(c,u);if(f===s)return f;if(f)return o(r).call(c,u)}else if(n.isObject(u)){for(var p=i(h),d=0;d<p.length;++d){var v=p[d];if(h[v]!=u[v])continue e}return o(r).call(c,u)}}return t}}var n=e("./util"),i=e("./es5").keys,o=n.tryCatch,s=n.errorObj;return r}},{"./es5":13,"./util":36}],8:[function(e,t,r){"use strict";t.exports=function(e){function t(){this._trace=new t.CapturedTrace(n())}function r(){return i?new t:void 0}function n(){var e=o.length-1;return e>=0?o[e]:void 0}var i=!1,o=[];return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var e=o.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=r,t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var r=e.prototype._pushContext,o=e.prototype._popContext,s=e._peekContext,a=e.prototype._peekContext,u=e.prototype._promiseCreated;t.deactivateLongStackTraces=function(){e.prototype._pushContext=r,e.prototype._popContext=o,e._peekContext=s,e.prototype._peekContext=a,e.prototype._promiseCreated=u,i=!1},i=!0,e.prototype._pushContext=t.prototype._pushContext,e.prototype._popContext=t.prototype._popContext,e._peekContext=e.prototype._peekContext=n,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},t}},{}],9:[function(t,r,n){"use strict";r.exports=function(r,n){function i(e,t){return{promise:t}}function o(){return!1}function s(e,t,r){var n=this;try{e(t,r,function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+N.toString(e));n._attachCancellationCallback(e)})}catch(i){return i}}function a(e){if(!this.isCancellable())return this;var t=this._onCancel();void 0!==t?N.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function u(){return this._onCancelField}function c(e){this._onCancelField=e}function l(){this._cancellationParent=void 0,this._onCancelField=void 0}function h(e,t){if(0!==(1&t)){this._cancellationParent=e;var r=e._branchesRemainingToCancel;void 0===r&&(r=0),e._branchesRemainingToCancel=r+1}0!==(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function f(e,t){0!==(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function p(){var e=this._boundTo;return void 0!==e&&e instanceof r?e.isFulfilled()?e.value():void 0:e}function d(){this._trace=new A(this._peekContext())}function v(e,t){if(B(e)){var r=this._trace;if(void 0!==r&&t&&(r=r._parent),void 0!==r)r.attachExtraTrace(e);else if(!e.__stackCleaned__){var n=E(e);N.notEnumerableProp(e,"stack",n.message+"\n"+n.stack.join("\n")),N.notEnumerableProp(e,"__stackCleaned__",!0)}}}function _(e,t,r,n,i){if(void 0===e&&null!==t&&$){if(void 0!==i&&i._returnedNonUndefined())return;var o=n._bitField;if(0===(65535&o))return;r&&(r+=" ");var s="a promise was created in a "+r+"handler but was not returned from it";n._warn(s,!0,t)}}function y(e,t){var r=e+" is deprecated and will be removed in a future version.";return t&&(r+=" Use "+t+" instead."),g(r)}function g(e,t,n){if(ie.warnings){var i,o=new U(e);if(t)n._attachExtraTrace(o);else if(ie.longStackTraces&&(i=r._peekContext()))i.attachExtraTrace(o);else{var s=E(o);o.stack=s.message+"\n"+s.stack.join("\n")}Z("warning",o)||P(o,"",!0)}}function m(e,t){for(var r=0;r<t.length-1;++r)t[r].push("From previous event:"),t[r]=t[r].join("\n");return r<t.length&&(t[r]=t[r].join("\n")),e+"\n"+t.join("\n")}function b(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}function w(e){for(var t=e[0],r=1;r<e.length;++r){for(var n=e[r],i=t.length-1,o=t[i],s=-1,a=n.length-1;a>=0;--a)if(n[a]===o){s=a;break}for(var a=s;a>=0;--a){var u=n[a];if(t[i]!==u)break;t.pop(),i--}t=n}}function k(e){for(var t=[],r=0;r<e.length;++r){var n=e[r],i="    (No stack trace)"===n||V.test(n),o=i&&te(n);i&&!o&&(W&&" "!==n.charAt(0)&&(n="    "+n),t.push(n))}return t}function C(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),r=0;r<t.length;++r){var n=t[r];if("    (No stack trace)"===n||V.test(n))break}return r>0&&(t=t.slice(r)),t}function E(e){var t=e.stack,r=e.toString();return t="string"==typeof t&&t.length>0?C(e):["    (No stack trace)"],{message:r,stack:k(t)}}function P(e,t,r){if("undefined"!=typeof console){var n;if(N.isObject(e)){var i=e.stack;n=t+q(i,e)}else n=t+String(e);"function"==typeof L?L(n,r):("function"==typeof console.log||"object"==typeof console.log)&&console.log(n)}}function T(e,t,r,n){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(n):t(r,n))}catch(o){H.throwLater(o)}"unhandledRejection"===e?Z(e,r,n)||i||P(r,"Unhandled rejection "):Z(e,n)}function F(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{t=e&&"function"==typeof e.toString?e.toString():N.toString(e);var r=/\[object [a-zA-Z0-9$_]+\]/;if(r.test(t))try{var n=JSON.stringify(e);t=n}catch(i){}0===t.length&&(t="(empty array)")}return"(<"+j(t)+">, no stack trace)"}function j(e){var t=41;return e.length<t?e:e.substr(0,t-3)+"..."}function S(){return"function"==typeof ne}function O(e){var t=e.match(re);return t?{fileName:t[1],line:parseInt(t[2],10)}:void 0}function x(e,t){if(S()){for(var r,n,i=e.stack.split("\n"),o=t.stack.split("\n"),s=-1,a=-1,u=0;u<i.length;++u){var c=O(i[u]);if(c){r=c.fileName,s=c.line;break}}for(var u=0;u<o.length;++u){var c=O(o[u]);if(c){n=c.fileName,a=c.line;break}}0>s||0>a||!r||!n||r!==n||s>=a||(te=function(e){if(M.test(e))return!0;var t=O(e);return t&&t.fileName===r&&s<=t.line&&t.line<=a?!0:!1})}}function A(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);ne(this,A),t>32&&this.uncycle()}var R,D,L,I=r._getDomain,H=r._async,U=t("./errors").Warning,N=t("./util"),B=N.canAttachTrace,M=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,V=null,q=null,W=!1,Q=!(0==N.env("BLUEBIRD_DEBUG")),G=!(0==N.env("BLUEBIRD_WARNINGS")||!Q&&!N.env("BLUEBIRD_WARNINGS")),z=!(0==N.env("BLUEBIRD_LONG_STACK_TRACES")||!Q&&!N.env("BLUEBIRD_LONG_STACK_TRACES")),$=0!=N.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(G||!!N.env("BLUEBIRD_W_FORGOTTEN_RETURN"));r.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=-1048577&e._bitField|524288},r.prototype._ensurePossibleRejectionHandled=function(){0===(524288&this._bitField)&&(this._setRejectionIsUnhandled(),H.invokeLater(this._notifyUnhandledRejection,this,void 0))},r.prototype._notifyUnhandledRejectionIsHandled=function(){T("rejectionHandled",R,void 0,this)},r.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},r.prototype._returnedNonUndefined=function(){return 0!==(268435456&this._bitField)},r.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),T("unhandledRejection",D,e,this)}},r.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},r.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},r.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},r.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},r.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},r.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},r.prototype._warn=function(e,t,r){return g(e,t,r||this)},r.onPossiblyUnhandledRejection=function(e){var t=I();D="function"==typeof e?null===t?e:t.bind(e):void 0},r.onUnhandledRejectionHandled=function(e){var t=I();R="function"==typeof e?null===t?e:t.bind(e):void 0};var X=function(){};r.longStackTraces=function(){if(H.haveItemsQueued()&&!ie.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!ie.longStackTraces&&S()){var e=r.prototype._captureStackTrace,t=r.prototype._attachExtraTrace;ie.longStackTraces=!0,X=function(){if(H.haveItemsQueued()&&!ie.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");r.prototype._captureStackTrace=e,r.prototype._attachExtraTrace=t,n.deactivateLongStackTraces(),H.enableTrampoline(),ie.longStackTraces=!1},r.prototype._captureStackTrace=d,r.prototype._attachExtraTrace=v,n.activateLongStackTraces(),H.disableTrampolineIfNecessary()}},r.hasLongStackTraces=function(){return ie.longStackTraces&&S()};var K=function(){try{var e=document.createEvent("CustomEvent");return e.initCustomEvent("testingtheevent",!1,!0,{}),N.global.dispatchEvent(e),function(e,t){var r=document.createEvent("CustomEvent");return r.initCustomEvent(e.toLowerCase(),!1,!0,t),!N.global.dispatchEvent(r)}}catch(t){}return function(){return!1}}(),Y=function(){return N.isNode?function(){return e.emit.apply(e,arguments)}:N.global?function(e){var t="on"+e.toLowerCase(),r=N.global[t];return r?(r.apply(N.global,[].slice.call(arguments,1)),!0):!1}:function(){return!1}}(),J={promiseCreated:i,promiseFulfilled:i,promiseRejected:i,promiseResolved:i,promiseCancelled:i,promiseChained:function(e,t,r){return{promise:t,child:r}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,r){return{reason:t,promise:r}},rejectionHandled:i},Z=function(e){var t=!1;try{t=Y.apply(null,arguments)}catch(r){H.throwLater(r),t=!0}var n=!1;try{n=K(e,J[e].apply(null,arguments))}catch(r){H.throwLater(r),n=!0}return n||t};r.config=function(e){if(e=Object(e),"longStackTraces"in e&&(e.longStackTraces?r.longStackTraces():!e.longStackTraces&&r.hasLongStackTraces()&&X()),"warnings"in e){var t=e.warnings;ie.warnings=!!t,$=ie.warnings,N.isObject(t)&&"wForgottenReturn"in t&&($=!!t.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!ie.cancellation){if(H.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");r.prototype._clearCancellationData=l,r.prototype._propagateFrom=h,r.prototype._onCancel=u,r.prototype._setOnCancel=c,r.prototype._attachCancellationCallback=a,r.prototype._execute=s,ee=h,ie.cancellation=!0}"monitoring"in e&&(e.monitoring&&!ie.monitoring?(ie.monitoring=!0,r.prototype._fireEvent=Z):!e.monitoring&&ie.monitoring&&(ie.monitoring=!1,r.prototype._fireEvent=o))},r.prototype._fireEvent=o,r.prototype._execute=function(e,t,r){try{e(t,r)}catch(n){return n}},r.prototype._onCancel=function(){},r.prototype._setOnCancel=function(e){},r.prototype._attachCancellationCallback=function(e){},r.prototype._captureStackTrace=function(){},r.prototype._attachExtraTrace=function(){},r.prototype._clearCancellationData=function(){},r.prototype._propagateFrom=function(e,t){};var ee=f,te=function(){return!1},re=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;N.inherits(A,Error),n.CapturedTrace=A,A.prototype.uncycle=function(){var e=this._length;if(!(2>e)){for(var t=[],r={},n=0,i=this;void 0!==i;++n)t.push(i),i=i._parent;e=this._length=n;for(var n=e-1;n>=0;--n){var o=t[n].stack;void 0===r[o]&&(r[o]=n)}for(var n=0;e>n;++n){var s=t[n].stack,a=r[s];if(void 0!==a&&a!==n){a>0&&(t[a-1]._parent=void 0,t[a-1]._length=1),t[n]._parent=void 0,t[n]._length=1;var u=n>0?t[n-1]:this;e-1>a?(u._parent=t[a+1],u._parent.uncycle(),u._length=u._parent._length+1):(u._parent=void 0,u._length=1);for(var c=u._length+1,l=n-2;l>=0;--l)t[l]._length=c,c++;return}}}},A.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=E(e),r=t.message,n=[t.stack],i=this;void 0!==i;)n.push(k(i.stack.split("\n"))),i=i._parent;w(n),b(n),N.notEnumerableProp(e,"stack",m(r,n)),N.notEnumerableProp(e,"__stackCleaned__",!0)}};var ne=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():F(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,V=e,q=t;var r=Error.captureStackTrace;return te=function(e){return M.test(e)},function(e,t){Error.stackTraceLimit+=6,r(e,t),Error.stackTraceLimit-=6}}var n=new Error;if("string"==typeof n.stack&&n.stack.split("\n")[0].indexOf("stackDetection@")>=0)return V=/@/,q=t,W=!0,function(e){e.stack=(new Error).stack};var i;try{throw new Error}catch(o){i="stack"in o}return"stack"in n||!i||"number"!=typeof Error.stackTraceLimit?(q=function(e,t){return"string"==typeof e?e:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?F(t):t.toString()},null):(V=e,q=t,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6})}([]);"undefined"!=typeof console&&"undefined"!=typeof console.warn&&(L=function(e){console.warn(e)},N.isNode&&e.stderr.isTTY?L=function(e,t){var r=t?"[33m":"[31m";console.warn(r+e+"[0m\n")}:N.isNode||"string"!=typeof(new Error).stack||(L=function(e,t){console.warn("%c"+e,t?"color: darkorange":"color: red")}));var ie={warnings:G,longStackTraces:!1,cancellation:!1,monitoring:!1};return z&&r.longStackTraces(),{longStackTraces:function(){return ie.longStackTraces},warnings:function(){return ie.warnings},cancellation:function(){return ie.cancellation},monitoring:function(){return ie.monitoring},propagateFromFunction:function(){return ee},boundValueFunction:function(){return p},checkForgottenReturns:_,setBounds:x,warn:g,deprecated:y,CapturedTrace:A,fireDomEvent:K,fireGlobalEvent:Y}}},{"./errors":12,"./util":36}],10:[function(e,t,r){"use strict";t.exports=function(e){function t(){return this.value}function r(){throw this.reason}e.prototype["return"]=e.prototype.thenReturn=function(r){return r instanceof e&&r.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:r},void 0)},e.prototype["throw"]=e.prototype.thenThrow=function(e){return this._then(r,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,r,void 0,{reason:e},void 0);var t=arguments[1],n=function(){throw t};return this.caught(e,n)},e.prototype.catchReturn=function(r){if(arguments.length<=1)return r instanceof e&&r.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:r},void 0);var n=arguments[1];n instanceof e&&n.suppressUnhandledRejections();var i=function(){return n};return this.caught(r,i)}}},{}],11:[function(e,t,r){"use strict";t.exports=function(e,t){function r(){return o(this)}function n(e,r){return i(e,r,t,t)}var i=e.reduce,o=e.all;e.prototype.each=function(e){return this.mapSeries(e)._then(r,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return i(this,e,t,t)},e.each=function(e,t){return n(e,t)._then(r,void 0,void 0,e,void 0)},e.mapSeries=n}},{}],12:[function(e,t,r){"use strict";function n(e,t){function r(n){return this instanceof r?(h(this,"message","string"==typeof n?n:t),h(this,"name",e),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new r(n)}return l(r,Error),r}function i(e){return this instanceof i?(h(this,"name","OperationalError"),h(this,"message",e),this.cause=e,this.isOperational=!0,void(e instanceof Error?(h(this,"message",e.message),h(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new i(e)}var o,s,a=e("./es5"),u=a.freeze,c=e("./util"),l=c.inherits,h=c.notEnumerableProp,f=n("Warning","warning"),p=n("CancellationError","cancellation error"),d=n("TimeoutError","timeout error"),v=n("AggregateError","aggregate error");try{o=TypeError,s=RangeError}catch(_){o=n("TypeError","type error"),s=n("RangeError","range error")}for(var y="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),g=0;g<y.length;++g)"function"==typeof Array.prototype[y[g]]&&(v.prototype[y[g]]=Array.prototype[y[g]]);a.defineProperty(v.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),v.prototype.isOperational=!0;var m=0;v.prototype.toString=function(){var e=Array(4*m+1).join(" "),t="\n"+e+"AggregateError of:\n";m++,e=Array(4*m+1).join(" ");for(var r=0;r<this.length;++r){for(var n=this[r]===this?"[Circular AggregateError]":this[r]+"",i=n.split("\n"),o=0;o<i.length;++o)i[o]=e+i[o];n=i.join("\n"),t+=n+"\n"}return m--,t},l(i,Error);var b=Error.__BluebirdErrorTypes__;b||(b=u({CancellationError:p,TimeoutError:d,OperationalError:i,RejectionError:i,AggregateError:v}),a.defineProperty(Error,"__BluebirdErrorTypes__",{value:b,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:o,RangeError:s,CancellationError:b.CancellationError,OperationalError:b.OperationalError,TimeoutError:b.TimeoutError,AggregateError:b.AggregateError,Warning:f}},{"./es5":13,"./util":36}],13:[function(e,t,r){var n=function(){"use strict";return void 0===this}();if(n)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:n,propertyIsWritable:function(e,t){var r=Object.getOwnPropertyDescriptor(e,t);return!(r&&!r.writable&&!r.set)}};else{var i={}.hasOwnProperty,o={}.toString,s={}.constructor.prototype,a=function(e){var t=[];for(var r in e)i.call(e,r)&&t.push(r);return t},u=function(e,t){return{value:e[t]}},c=function(e,t,r){return e[t]=r.value,e},l=function(e){return e},h=function(e){try{return Object(e).constructor.prototype}catch(t){return s}},f=function(e){try{return"[object Array]"===o.call(e)}catch(t){return!1}};t.exports={isArray:f,keys:a,names:a,defineProperty:c,getDescriptor:u,freeze:l,getPrototypeOf:h,isES5:n,propertyIsWritable:function(){return!0}}}},{}],14:[function(e,t,r){"use strict";t.exports=function(e,t){var r=e.map;e.prototype.filter=function(e,n){return r(this,e,n,t)},e.filter=function(e,n,i){return r(e,n,i,t)}}},{}],15:[function(e,t,r){"use strict";t.exports=function(t,r){function n(e,t,r){this.promise=e,this.type=t,this.handler=r,this.called=!1,this.cancelPromise=null}function i(e){this.finallyHandler=e}function o(e,t){return null!=e.cancelPromise?(arguments.length>1?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0):!1}function s(){return u.call(this,this.promise._target()._settledValue())}function a(e){return o(this,e)?void 0:(h.e=e,h)}function u(e){var n=this.promise,u=this.handler;if(!this.called){this.called=!0;var c=this.isFinallyHandler()?u.call(n._boundValue()):u.call(n._boundValue(),e);if(void 0!==c){n._setReturnedNonUndefined();var f=r(c,n);if(f instanceof t){if(null!=this.cancelPromise){if(f.isCancelled()){var p=new l("late cancellation observer");return n._attachExtraTrace(p),h.e=p,h}f.isPending()&&f._attachCancellationCallback(new i(this))}return f._then(s,a,void 0,this,void 0)}}}return n.isRejected()?(o(this),h.e=e,h):(o(this),e)}var c=e("./util"),l=t.CancellationError,h=c.errorObj;return n.prototype.isFinallyHandler=function(){return 0===this.type},i.prototype._resultCancelled=function(){o(this.finallyHandler)},t.prototype._passThrough=function(e,t,r,i){return"function"!=typeof e?this.then():this._then(r,i,void 0,new n(this,t,e),void 0)},t.prototype.lastly=t.prototype["finally"]=function(e){return this._passThrough(e,0,u,u)},t.prototype.tap=function(e){return this._passThrough(e,1,u)},n}},{"./util":36}],16:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o,s){function a(e,r,n){for(var o=0;o<r.length;++o){n._pushContext();var s=p(r[o])(e);if(n._popContext(),s===f){n._pushContext();var a=t.reject(f.e);return n._popContext(),a}var u=i(s,n);if(u instanceof t)return u}return null}function u(e,r,i,o){var s=this._promise=new t(n);s._captureStackTrace(),s._setOnCancel(this),this._stack=o,this._generatorFunction=e,this._receiver=r,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(d):d,this._yieldedPromise=null}var c=e("./errors"),l=c.TypeError,h=e("./util"),f=h.errorObj,p=h.tryCatch,d=[];h.inherits(u,o),u.prototype._isResolved=function(){return null===this._promise},u.prototype._cleanup=function(){this._promise=this._generator=null},u.prototype._promiseCancelled=function(){if(!this._isResolved()){var e,r="undefined"!=typeof this._generator["return"];if(r)this._promise._pushContext(),e=p(this._generator["return"]).call(this._generator,void 0),this._promise._popContext();else{var n=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),e=p(this._generator["throw"]).call(this._generator,n),this._promise._popContext(),e===f&&e.e===n&&(e=null)}var i=this._promise;this._cleanup(),e===f?i._rejectCallback(e.e,!1):i.cancel()}},u.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=p(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},u.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=p(this._generator["throw"]).call(this._generator,e);this._promise._popContext(),this._continue(t)},u.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,this._promiseCancelled(),e.cancel()}},u.prototype.promise=function(){return this._promise},u.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},u.prototype._continue=function(e){var r=this._promise;if(e===f)return this._cleanup(),r._rejectCallback(e.e,!1);var n=e.value;if(e.done===!0)return this._cleanup(),r._resolveCallback(n);var o=i(n,this._promise);if(!(o instanceof t)&&(o=a(o,this._yieldHandlers,this._promise),null===o))return void this._promiseRejected(new l("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",n)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));o=o._target();var s=o._bitField;0===(50397184&s)?(this._yieldedPromise=o,o._proxy(this,null)):0!==(33554432&s)?this._promiseFulfilled(o._value()):0!==(16777216&s)?this._promiseRejected(o._reason()):this._promiseCancelled()},t.coroutine=function(e,t){if("function"!=typeof e)throw new l("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=Object(t).yieldHandler,n=u,i=(new Error).stack;return function(){var t=e.apply(this,arguments),o=new n(void 0,void 0,r,i),s=o.promise();return o._generator=t,o._promiseFulfilled(void 0),s}},t.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new l("expecting a function but got "+h.classString(e));d.push(e)},t.spawn=function(e){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof e)return r("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=new u(e,this),i=n.promise();return n._run(t.spawn),i}}},{"./errors":12,"./util":36}],17:[function(e,t,r){"use strict";t.exports=function(t,r,n,i){var o=e("./util");o.canEvaluate,o.tryCatch,o.errorObj;t.join=function(){var e,t=arguments.length-1;if(t>0&&"function"==typeof arguments[t]){e=arguments[t];var n}var i=[].slice.call(arguments);e&&i.pop();var n=new r(i).promise();return void 0!==e?n.spread(e):n}}},{"./util":36}],18:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o,s){function a(e,t,r,n){this.constructor$(e),this._promise._captureStackTrace();var i=c();this._callback=null===i?t:i.bind(t),this._preservedValues=n===o?new Array(this.length()):null,this._limit=r,this._inFlight=0,this._queue=r>=1?[]:p,this._init$(void 0,-2);
}function u(e,t,r,i){if("function"!=typeof t)return n("expecting a function but got "+l.classString(t));var o="object"==typeof r&&null!==r?r.concurrency:0;return o="number"==typeof o&&isFinite(o)&&o>=1?o:0,new a(e,t,o,i).promise()}var c=t._getDomain,l=e("./util"),h=l.tryCatch,f=l.errorObj,p=[];l.inherits(a,r),a.prototype._init=function(){},a.prototype._promiseFulfilled=function(e,r){var n=this._values,o=this.length(),a=this._preservedValues,u=this._limit;if(0>r){if(r=-1*r-1,n[r]=e,u>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(u>=1&&this._inFlight>=u)return n[r]=e,this._queue.push(r),!1;null!==a&&(a[r]=e);var c=this._promise,l=this._callback,p=c._boundValue();c._pushContext();var d=h(l).call(p,e,r,o),v=c._popContext();if(s.checkForgottenReturns(d,v,null!==a?"Promise.filter":"Promise.map",c),d===f)return this._reject(d.e),!0;var _=i(d,this._promise);if(_ instanceof t){_=_._target();var y=_._bitField;if(0===(50397184&y))return u>=1&&this._inFlight++,n[r]=_,_._proxy(this,-1*(r+1)),!1;if(0===(33554432&y))return 0!==(16777216&y)?(this._reject(_._reason()),!0):(this._cancel(),!0);d=_._value()}n[r]=d}var g=++this._totalResolved;return g>=o?(null!==a?this._filter(n,a):this._resolve(n),!0):!1},a.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,r=this._values;e.length>0&&this._inFlight<t;){if(this._isResolved())return;var n=e.pop();this._promiseFulfilled(r[n],n)}},a.prototype._filter=function(e,t){for(var r=t.length,n=new Array(r),i=0,o=0;r>o;++o)e[o]&&(n[i++]=t[o]);n.length=i,this._resolve(n)},a.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return u(this,e,t,null)},t.map=function(e,t,r,n){return u(e,t,r,n)}}},{"./util":36}],19:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o){var s=e("./util"),a=s.tryCatch;t.method=function(e){if("function"!=typeof e)throw new t.TypeError("expecting a function but got "+s.classString(e));return function(){var n=new t(r);n._captureStackTrace(),n._pushContext();var i=a(e).apply(this,arguments),s=n._popContext();return o.checkForgottenReturns(i,s,"Promise.method",n),n._resolveFromSyncValue(i),n}},t.attempt=t["try"]=function(e){if("function"!=typeof e)return i("expecting a function but got "+s.classString(e));var n=new t(r);n._captureStackTrace(),n._pushContext();var u;if(arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var c=arguments[1],l=arguments[2];u=s.isArray(c)?a(e).apply(l,c):a(e).call(l,c)}else u=a(e)();var h=n._popContext();return o.checkForgottenReturns(u,h,"Promise.try",n),n._resolveFromSyncValue(u),n},t.prototype._resolveFromSyncValue=function(e){e===s.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t,r){"use strict";function n(e){return e instanceof Error&&l.getPrototypeOf(e)===Error.prototype}function i(e){var t;if(n(e)){t=new c(e),t.name=e.name,t.message=e.message,t.stack=e.stack;for(var r=l.keys(e),i=0;i<r.length;++i){var o=r[i];h.test(o)||(t[o]=e[o])}return t}return s.markAsOriginatingFromRejection(e),e}function o(e,t){return function(r,n){if(null!==e){if(r){var o=i(a(r));e._attachExtraTrace(o),e._reject(o)}else if(t){var s=[].slice.call(arguments,1);e._fulfill(s)}else e._fulfill(n);e=null}}}var s=e("./util"),a=s.maybeWrapAsError,u=e("./errors"),c=u.OperationalError,l=e("./es5"),h=/^(?:name|message|stack|cause)$/;t.exports=o},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t,r){"use strict";t.exports=function(t){function r(e,t){var r=this;if(!o.isArray(e))return n.call(r,e,t);var i=a(t).apply(r._boundValue(),[null].concat(e));i===u&&s.throwLater(i.e)}function n(e,t){var r=this,n=r._boundValue(),i=void 0===e?a(t).call(n,null):a(t).call(n,null,e);i===u&&s.throwLater(i.e)}function i(e,t){var r=this;if(!e){var n=new Error(e+"");n.cause=e,e=n}var i=a(t).call(r._boundValue(),e);i===u&&s.throwLater(i.e)}var o=e("./util"),s=t._async,a=o.tryCatch,u=o.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(e,t){if("function"==typeof e){var o=n;void 0!==t&&Object(t).spread&&(o=r),this._then(o,i,void 0,this,e)}return this}}},{"./util":36}],22:[function(t,r,n){"use strict";r.exports=function(){function r(){}function n(e,t){if("function"!=typeof t)throw new g("expecting a function but got "+p.classString(t));if(e.constructor!==i)throw new g("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n")}function i(e){this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,e!==b&&(n(this,e),this._resolveFromExecutor(e)),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function o(e){this.promise._resolveCallback(e)}function s(e){this.promise._rejectCallback(e,!1)}function a(e){var t=new i(b);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}var u,c=function(){return new g("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},l=function(){return new i.PromiseInspection(this._target())},h=function(e){return i.reject(new g(e))},f={},p=t("./util");u=p.isNode?function(){var t=e.domain;return void 0===t&&(t=null),t}:function(){return null},p.notEnumerableProp(i,"_getDomain",u);var d=t("./es5"),v=t("./async"),_=new v;d.defineProperty(i,"_async",{value:_});var y=t("./errors"),g=i.TypeError=y.TypeError;i.RangeError=y.RangeError;var m=i.CancellationError=y.CancellationError;i.TimeoutError=y.TimeoutError,i.OperationalError=y.OperationalError,i.RejectionError=y.OperationalError,i.AggregateError=y.AggregateError;var b=function(){},w={},k={},C=t("./thenables")(i,b),E=t("./promise_array")(i,b,C,h,r),P=t("./context")(i),T=P.create,F=t("./debuggability")(i,P),j=(F.CapturedTrace,t("./finally")(i,C)),S=t("./catch_filter")(k),O=t("./nodeback"),x=p.errorObj,A=p.tryCatch;return i.prototype.toString=function(){return"[object Promise]"},i.prototype.caught=i.prototype["catch"]=function(e){var t=arguments.length;if(t>1){var r,n=new Array(t-1),i=0;for(r=0;t-1>r;++r){var o=arguments[r];if(!p.isObject(o))return h("expecting an object but got "+p.classString(o));n[i++]=o}return n.length=i,e=arguments[r],this.then(void 0,S(n,e,this))}return this.then(void 0,e)},i.prototype.reflect=function(){return this._then(l,l,void 0,this,void 0)},i.prototype.then=function(e,t){if(F.warnings()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var r=".then() only accepts functions but was passed: "+p.classString(e);arguments.length>1&&(r+=", "+p.classString(t)),this._warn(r)}return this._then(e,t,void 0,void 0,void 0)},i.prototype.done=function(e,t){var r=this._then(e,t,void 0,void 0,void 0);r._setIsFinal()},i.prototype.spread=function(e){return"function"!=typeof e?h("expecting a function but got "+p.classString(e)):this.all()._then(e,void 0,void 0,w,void 0)},i.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},i.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new E(this).promise()},i.prototype.error=function(e){return this.caught(p.originatesFromRejection,e)},i.is=function(e){return e instanceof i},i.fromNode=i.fromCallback=function(e){var t=new i(b);t._captureStackTrace();var r=arguments.length>1?!!Object(arguments[1]).multiArgs:!1,n=A(e)(O(t,r));return n===x&&t._rejectCallback(n.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},i.all=function(e){return new E(e).promise()},i.cast=function(e){var t=C(e);return t instanceof i||(t=new i(b),t._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},i.resolve=i.fulfilled=i.cast,i.reject=i.rejected=function(e){var t=new i(b);return t._captureStackTrace(),t._rejectCallback(e,!0),t},i.setScheduler=function(e){if("function"!=typeof e)throw new g("expecting a function but got "+p.classString(e));var t=_._schedule;return _._schedule=e,t},i.prototype._then=function(e,t,r,n,o){var s=void 0!==o,a=s?o:new i(b),c=this._target(),l=c._bitField;s||(a._propagateFrom(this,3),a._captureStackTrace(),void 0===n&&0!==(2097152&this._bitField)&&(n=0!==(50397184&l)?this._boundValue():c===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,a));var h=u();if(0!==(50397184&l)){var f,p,d=c._settlePromiseCtx;0!==(33554432&l)?(p=c._rejectionHandler0,f=e):0!==(16777216&l)?(p=c._fulfillmentHandler0,f=t,c._unsetRejectionIsUnhandled()):(d=c._settlePromiseLateCancellationObserver,p=new m("late cancellation observer"),c._attachExtraTrace(p),f=t),_.invoke(d,c,{handler:null===h?f:"function"==typeof f&&h.bind(f),promise:a,receiver:n,value:p})}else c._addCallbacks(e,t,a,n,h);return a},i.prototype._length=function(){return 65535&this._bitField},i.prototype._isFateSealed=function(){return 0!==(117506048&this._bitField)},i.prototype._isFollowing=function(){return 67108864===(67108864&this._bitField)},i.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},i.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},i.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},i.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},i.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},i.prototype._isFinal=function(){return(4194304&this._bitField)>0},i.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},i.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},i.prototype._setAsyncGuaranteed=function(){this._bitField=134217728|this._bitField},i.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==f)return void 0===t&&this._isBound()?this._boundValue():t},i.prototype._promiseAt=function(e){return this[4*e-4+2]},i.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},i.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},i.prototype._boundValue=function(){},i.prototype._migrateCallback0=function(e){var t=(e._bitField,e._fulfillmentHandler0),r=e._rejectionHandler0,n=e._promise0,i=e._receiverAt(0);void 0===i&&(i=f),this._addCallbacks(t,r,n,i,null)},i.prototype._migrateCallbackAt=function(e,t){var r=e._fulfillmentHandlerAt(t),n=e._rejectionHandlerAt(t),i=e._promiseAt(t),o=e._receiverAt(t);void 0===o&&(o=f),this._addCallbacks(r,n,i,o,null)},i.prototype._addCallbacks=function(e,t,r,n,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=r,this._receiver0=n,"function"==typeof e&&(this._fulfillmentHandler0=null===i?e:i.bind(e)),"function"==typeof t&&(this._rejectionHandler0=null===i?t:i.bind(t));else{var s=4*o-4;this[s+2]=r,this[s+3]=n,"function"==typeof e&&(this[s+0]=null===i?e:i.bind(e)),"function"==typeof t&&(this[s+1]=null===i?t:i.bind(t))}return this._setLength(o+1),o},i.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},i.prototype._resolveCallback=function(e,t){if(0===(117506048&this._bitField)){if(e===this)return this._rejectCallback(c(),!1);var r=C(e,this);if(!(r instanceof i))return this._fulfill(e);t&&this._propagateFrom(r,2);var n=r._target();if(n===this)return void this._reject(c());var o=n._bitField;if(0===(50397184&o)){var s=this._length();s>0&&n._migrateCallback0(this);for(var a=1;s>a;++a)n._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(n)}else if(0!==(33554432&o))this._fulfill(n._value());else if(0!==(16777216&o))this._reject(n._reason());else{var u=new m("late cancellation observer");n._attachExtraTrace(u),this._reject(u)}}},i.prototype._rejectCallback=function(e,t,r){var n=p.ensureErrorObject(e),i=n===e;if(!i&&!r&&F.warnings()){var o="a promise was rejected with a non-error: "+p.classString(e);this._warn(o,!0)}this._attachExtraTrace(n,t?i:!1),this._reject(e)},i.prototype._resolveFromExecutor=function(e){var t=this;this._captureStackTrace(),this._pushContext();var r=!0,n=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,r)});r=!1,this._popContext(),void 0!==n&&t._rejectCallback(n,!0)},i.prototype._settlePromiseFromHandler=function(e,t,r,n){var i=n._bitField;if(0===(65536&i)){n._pushContext();var o;t===w?r&&"number"==typeof r.length?o=A(e).apply(this._boundValue(),r):(o=x,o.e=new g("cannot .spread() a non-array: "+p.classString(r))):o=A(e).call(t,r);var s=n._popContext();i=n._bitField,0===(65536&i)&&(o===k?n._reject(r):o===x?n._rejectCallback(o.e,!1):(F.checkForgottenReturns(o,s,"",n,this),n._resolveCallback(o)))}},i.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},i.prototype._followee=function(){return this._rejectionHandler0},i.prototype._setFollowee=function(e){this._rejectionHandler0=e},i.prototype._settlePromise=function(e,t,n,o){var s=e instanceof i,a=this._bitField,u=0!==(134217728&a);0!==(65536&a)?(s&&e._invokeInternalOnCancel(),n instanceof j&&n.isFinallyHandler()?(n.cancelPromise=e,A(t).call(n,o)===x&&e._reject(x.e)):t===l?e._fulfill(l.call(n)):n instanceof r?n._promiseCancelled(e):s||e instanceof E?e._cancel():n.cancel()):"function"==typeof t?s?(u&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,n,o,e)):t.call(n,o,e):n instanceof r?n._isResolved()||(0!==(33554432&a)?n._promiseFulfilled(o,e):n._promiseRejected(o,e)):s&&(u&&e._setAsyncGuaranteed(),0!==(33554432&a)?e._fulfill(o):e._reject(o))},i.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,r=e.promise,n=e.receiver,o=e.value;"function"==typeof t?r instanceof i?this._settlePromiseFromHandler(t,n,o,r):t.call(n,o,r):r instanceof i&&r._reject(o)},i.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},i.prototype._settlePromise0=function(e,t,r){var n=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(n,e,i,t)},i.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},i.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var r=c();return this._attachExtraTrace(r),this._reject(r)}this._setFulfilled(),this._rejectionHandler0=e,(65535&t)>0&&(0!==(134217728&t)?this._settlePromises():_.settlePromises(this))}},i.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16))return this._setRejected(),this._fulfillmentHandler0=e,this._isFinal()?_.fatalError(e,p.isNode):void((65535&t)>0?_.settlePromises(this):this._ensurePossibleRejectionHandled())},i.prototype._fulfillPromises=function(e,t){for(var r=1;e>r;r++){var n=this._fulfillmentHandlerAt(r),i=this._promiseAt(r),o=this._receiverAt(r);this._clearCallbackDataAtIndex(r),this._settlePromise(i,n,o,t)}},i.prototype._rejectPromises=function(e,t){for(var r=1;e>r;r++){var n=this._rejectionHandlerAt(r),i=this._promiseAt(r),o=this._receiverAt(r);this._clearCallbackDataAtIndex(r),this._settlePromise(i,n,o,t)}},i.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(t>0){if(0!==(16842752&e)){var r=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,r,e),this._rejectPromises(t,r)}else{var n=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,n,e),this._fulfillPromises(t,n)}this._setLength(0)}this._clearCancellationData()},i.prototype._settledValue=function(){var e=this._bitField;return 0!==(33554432&e)?this._rejectionHandler0:0!==(16777216&e)?this._fulfillmentHandler0:void 0},i.defer=i.pending=function(){F.deprecated("Promise.defer","new Promise");var e=new i(b);return{promise:e,resolve:o,reject:s}},p.notEnumerableProp(i,"_makeSelfResolutionError",c),t("./method")(i,b,C,h,F),t("./bind")(i,b,C,F),t("./cancel")(i,E,h,F),t("./direct_resolve")(i),t("./synchronous_inspection")(i),t("./join")(i,E,C,b,F),i.Promise=i,t("./map.js")(i,E,h,C,b,F),t("./using.js")(i,h,C,T,b,F),t("./timers.js")(i,b,F),t("./generators.js")(i,h,b,C,r,F),t("./nodeify.js")(i),t("./call_get.js")(i),t("./props.js")(i,E,C,h),t("./race.js")(i,b,C,h),t("./reduce.js")(i,E,h,C,b,F),t("./settle.js")(i,E,F),t("./some.js")(i,E,h),t("./promisify.js")(i,b),t("./any.js")(i),t("./each.js")(i,b),t("./filter.js")(i,b),p.toFastProperties(i),p.toFastProperties(i.prototype),a({a:1}),a({b:2}),a({c:3}),a(1),a(function(){}),a(void 0),a(!1),a(new i(b)),F.setBounds(v.firstLineError,p.lastLineError),i}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o){function s(e){switch(e){case-2:return[];case-3:return{}}}function a(e){var n=this._promise=new t(r);e instanceof t&&n._propagateFrom(e,3),n._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var u=e("./util");u.isArray;return u.inherits(a,o),a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function c(e,r){var o=n(this._values,this._promise);if(o instanceof t){o=o._target();var a=o._bitField;if(this._values=o,0===(50397184&a))return this._promise._setAsyncGuaranteed(),o._then(c,this._reject,void 0,this,r);if(0===(33554432&a))return 0!==(16777216&a)?this._reject(o._reason()):this._cancel();o=o._value()}if(o=u.asArray(o),null===o){var l=i("expecting an array or an iterable object but got "+u.classString(o)).reason();return void this._promise._rejectCallback(l,!1)}return 0===o.length?void(-5===r?this._resolveEmptyArray():this._resolve(s(r))):void this._iterate(o)},a.prototype._iterate=function(e){var r=this.getActualLength(e.length);this._length=r,this._values=this.shouldCopyValues()?new Array(r):this._values;for(var i=this._promise,o=!1,s=null,a=0;r>a;++a){var u=n(e[a],i);u instanceof t?(u=u._target(),s=u._bitField):s=null,o?null!==s&&u.suppressUnhandledRejections():null!==s?0===(50397184&s)?(u._proxy(this,a),this._values[a]=u):o=0!==(33554432&s)?this._promiseFulfilled(u._value(),a):0!==(16777216&s)?this._promiseRejected(u._reason(),a):this._promiseCancelled(a):o=this._promiseFulfilled(u,a)}o||i._setAsyncGuaranteed()},a.prototype._isResolved=function(){return null===this._values},a.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},a.prototype._cancel=function(){!this._isResolved()&&this._promise.isCancellable()&&(this._values=null,this._promise._cancel())},a.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},a.prototype._promiseFulfilled=function(e,t){this._values[t]=e;var r=++this._totalResolved;return r>=this._length?(this._resolve(this._values),!0):!1},a.prototype._promiseCancelled=function(){return this._cancel(),!0},a.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},a.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var r=0;r<e.length;++r)e[r]instanceof t&&e[r].cancel()}},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(e){return e},a}},{"./util":36}],24:[function(e,t,r){"use strict";t.exports=function(t,r){function n(e){return!k.test(e)}function i(e){try{return e.__isPromisified__===!0}catch(t){return!1}}function o(e,t,r){var n=p.getDataPropertyOrDefault(e,t+r,b);return n?i(n):!1}function s(e,t,r){for(var n=0;n<e.length;n+=2){var i=e[n];if(r.test(i))for(var o=i.replace(r,""),s=0;s<e.length;s+=2)if(e[s]===o)throw new g("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}function a(e,t,r,n){for(var a=p.inheritedDataKeys(e),u=[],c=0;c<a.length;++c){var l=a[c],h=e[l],f=n===C?!0:C(l,h,e);"function"!=typeof h||i(h)||o(e,l,t)||!n(l,h,e,f)||u.push(l,h)}return s(u,t,r),u}function u(e,n,i,o,s,a){function u(){var i=n;n===f&&(i=this);var o=new t(r);o._captureStackTrace();var s="string"==typeof l&&this!==c?this[l]:e,u=d(o,a);try{s.apply(i,v(arguments,u))}catch(h){o._rejectCallback(_(h),!0,!0)}return o._isFateSealed()||o._setAsyncGuaranteed(),o}var c=function(){return this}(),l=e;return"string"==typeof l&&(e=o),p.notEnumerableProp(u,"__isPromisified__",!0),u}function c(e,t,r,n,i){for(var o=new RegExp(E(t)+"$"),s=a(e,t,o,r),u=0,c=s.length;c>u;u+=2){var l=s[u],h=s[u+1],d=l+t;if(n===P)e[d]=P(l,f,l,h,t,i);else{var v=n(h,function(){return P(l,f,l,h,t,i)});p.notEnumerableProp(v,"__isPromisified__",!0),e[d]=v}}return p.toFastProperties(e),e}function l(e,t,r){return P(e,t,void 0,e,null,r)}var h,f={},p=e("./util"),d=e("./nodeback"),v=p.withAppended,_=p.maybeWrapAsError,y=p.canEvaluate,g=e("./errors").TypeError,m="Async",b={__isPromisified__:!0},w=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],k=new RegExp("^(?:"+w.join("|")+")$"),C=function(e){return p.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e},E=function(e){return e.replace(/([$])/,"\\$")},P=y?h:u;t.promisify=function(e,t){if("function"!=typeof e)throw new g("expecting a function but got "+p.classString(e));if(i(e))return e;t=Object(t);var r=void 0===t.context?f:t.context,o=!!t.multiArgs,s=l(e,r,o);return p.copyDescriptors(e,s,n),s},t.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new g("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");t=Object(t);var r=!!t.multiArgs,n=t.suffix;"string"!=typeof n&&(n=m);var i=t.filter;"function"!=typeof i&&(i=C);var o=t.promisifier;if("function"!=typeof o&&(o=P),!p.isIdentifier(n))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var s=p.inheritedDataKeys(e),a=0;a<s.length;++a){var u=e[s[a]];"constructor"!==s[a]&&p.isClass(u)&&(c(u.prototype,n,i,o,r),c(u,n,i,o,r))}return c(e,n,i,o,r)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(e,t,r){"use strict";t.exports=function(t,r,n,i){function o(e){var t,r=!1;if(void 0!==a&&e instanceof a)t=h(e),r=!0;else{var n=l.keys(e),i=n.length;t=new Array(2*i);for(var o=0;i>o;++o){var s=n[o];t[o]=e[s],t[o+i]=s}}this.constructor$(t),this._isMap=r,this._init$(void 0,-3)}function s(e){var r,s=n(e);return c(s)?(r=s instanceof t?s._then(t.props,void 0,void 0,void 0,void 0):new o(s).promise(),s instanceof t&&r._propagateFrom(s,2),r):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var a,u=e("./util"),c=u.isObject,l=e("./es5");"function"==typeof Map&&(a=Map);var h=function(){function e(e,n){this[t]=e,this[t+r]=n,t++}var t=0,r=0;return function(n){r=n.size,t=0;var i=new Array(2*n.size);return n.forEach(e,i),i}}(),f=function(e){for(var t=new a,r=e.length/2|0,n=0;r>n;++n){var i=e[r+n],o=e[n];t.set(i,o)}return t};u.inherits(o,r),o.prototype._init=function(){},o.prototype._promiseFulfilled=function(e,t){this._values[t]=e;var r=++this._totalResolved;if(r>=this._length){var n;if(this._isMap)n=f(this._values);else{n={};for(var i=this.length(),o=0,s=this.length();s>o;++o)n[this._values[o+i]]=this._values[o]}return this._resolve(n),!0}return!1},o.prototype.shouldCopyValues=function(){return!1},o.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return s(this)},t.props=function(e){return s(e)}}},{"./es5":13,"./util":36}],26:[function(e,t,r){"use strict";function n(e,t,r,n,i){for(var o=0;i>o;++o)r[o+n]=e[o+t],e[o+t]=void 0}function i(e){this._capacity=e,this._length=0,this._front=0}i.prototype._willBeOverCapacity=function(e){return this._capacity<e},i.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1);var r=this._front+t&this._capacity-1;this[r]=e,this._length=t+1},i.prototype._unshiftOne=function(e){var t=this._capacity;this._checkCapacity(this.length()+1);var r=this._front,n=(r-1&t-1^t)-t;this[n]=e,this._front=n,this._length=this.length()+1},i.prototype.unshift=function(e,t,r){this._unshiftOne(r),this._unshiftOne(t),this._unshiftOne(e)},i.prototype.push=function(e,t,r){var n=this.length()+3;if(this._willBeOverCapacity(n))return this._pushOne(e),this._pushOne(t),void this._pushOne(r);var i=this._front+n-3;this._checkCapacity(n);var o=this._capacity-1;this[i+0&o]=e,this[i+1&o]=t,this[i+2&o]=r,this._length=n},i.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},i.prototype.length=function(){return this._length},i.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},i.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var r=this._front,i=this._length,o=r+i&t-1;n(this,0,this,t,o)},t.exports=i},{}],27:[function(e,t,r){"use strict";t.exports=function(t,r,n,i){function o(e,o){var u=n(e);if(u instanceof t)return a(u);if(e=s.asArray(e),null===e)return i("expecting an array or an iterable object but got "+s.classString(e));var c=new t(r);void 0!==o&&c._propagateFrom(o,3);for(var l=c._fulfill,h=c._reject,f=0,p=e.length;p>f;++f){var d=e[f];(void 0!==d||f in e)&&t.cast(d)._then(l,h,void 0,c,null)}return c}var s=e("./util"),a=function(e){return e.then(function(t){return o(t,e)})};t.race=function(e){return o(e,void 0)},t.prototype.race=function(){return o(this,void 0)}}},{"./util":36}],28:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o,s){function a(e,r,n,i){this.constructor$(e);var s=f();this._fn=null===s?r:s.bind(r),void 0!==n&&(n=t.resolve(n),n._attachCancellationCallback(this)),this._initialValue=n,this._currentCancellable=null,this._eachValues=i===o?[]:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function u(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function c(e,t,r,i){if("function"!=typeof t)return n("expecting a function but got "+p.classString(t));var o=new a(e,t,r,i);return o.promise()}function l(e){this.accum=e,this.array._gotAccum(e);var r=i(this.value,this.array._promise);return r instanceof t?(this.array._currentCancellable=r,r._then(h,void 0,void 0,this,void 0)):h.call(this,r)}function h(e){var r=this.array,n=r._promise,i=d(r._fn);n._pushContext();var o;o=void 0!==r._eachValues?i.call(n._boundValue(),e,this.index,this.length):i.call(n._boundValue(),this.accum,e,this.index,this.length),o instanceof t&&(r._currentCancellable=o);var a=n._popContext();return s.checkForgottenReturns(o,a,void 0!==r._eachValues?"Promise.each":"Promise.reduce",n),o}var f=t._getDomain,p=e("./util"),d=p.tryCatch;p.inherits(a,r),a.prototype._gotAccum=function(e){void 0!==this._eachValues&&e!==o&&this._eachValues.push(e)},a.prototype._eachComplete=function(e){return this._eachValues.push(e),this._eachValues},a.prototype._init=function(){},a.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},a.prototype.shouldCopyValues=function(){return!1},a.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},a.prototype._resultCancelled=function(e){return e===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel()))},a.prototype._iterate=function(e){this._values=e;var r,n,i=e.length;if(void 0!==this._initialValue?(r=this._initialValue,n=0):(r=t.resolve(e[0]),n=1),this._currentCancellable=r,!r.isRejected())for(;i>n;++n){var o={accum:null,value:e[n],index:n,length:i,array:this};r=r._then(l,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(r=r._then(this._eachComplete,void 0,void 0,this,void 0)),r._then(u,u,void 0,r,this)},t.prototype.reduce=function(e,t){return c(this,e,t,null)},t.reduce=function(e,t,r,n){return c(e,t,r,n)}}},{"./util":36}],29:[function(t,r,i){"use strict";var o,s=t("./util"),a=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")};if(s.isNode&&"undefined"==typeof MutationObserver){var u=n.setImmediate,c=e.nextTick;o=s.isRecentNode?function(e){u.call(n,e)}:function(t){c.call(e,t)}}else o="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&window.navigator.standalone?"undefined"!=typeof setImmediate?function(e){setImmediate(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:a:function(){var e=document.createElement("div"),t={attributes:!0},r=!1,n=document.createElement("div"),i=new MutationObserver(function(){e.classList.toggle("foo"),r=!1});i.observe(n,t);var o=function(){r||(r=!0,n.classList.toggle("foo"))};return function(r){var n=new MutationObserver(function(){n.disconnect(),r()});n.observe(e,t),o()}}();r.exports=o},{"./util":36}],30:[function(e,t,r){"use strict";t.exports=function(t,r,n){function i(e){this.constructor$(e)}var o=t.PromiseInspection,s=e("./util");s.inherits(i,r),i.prototype._promiseResolved=function(e,t){this._values[e]=t;var r=++this._totalResolved;return r>=this._length?(this._resolve(this._values),!0):!1},i.prototype._promiseFulfilled=function(e,t){var r=new o;return r._bitField=33554432,r._settledValueField=e,this._promiseResolved(t,r)},i.prototype._promiseRejected=function(e,t){var r=new o;return r._bitField=16777216,r._settledValueField=e,this._promiseResolved(t,r)},t.settle=function(e){return n.deprecated(".settle()",".reflect()"),new i(e).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(e,t,r){"use strict";t.exports=function(t,r,n){function i(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(e,t){if((0|t)!==t||0>t)return n("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var r=new i(e),o=r.promise();return r.setHowMany(t),r.init(),o}var s=e("./util"),a=e("./errors").RangeError,u=e("./errors").AggregateError,c=s.isArray,l={};s.inherits(i,r),i.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var e=c(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},i.prototype.init=function(){this._initialized=!0,this._init()},i.prototype.setUnwrap=function(){this._unwrap=!0},i.prototype.howMany=function(){return this._howMany},i.prototype.setHowMany=function(e){this._howMany=e},i.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()?(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0):!1},i.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},i.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(l),this._checkOutcome())},i.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new u,t=this.length();t<this._values.length;++t)this._values[t]!==l&&e.push(this._values[t]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},i.prototype._fulfilled=function(){return this._totalResolved},i.prototype._rejected=function(){return this._values.length-this.length()},i.prototype._addRejected=function(e){this._values.push(e)},i.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},i.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},i.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";
return new a(t)},i.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return o(e,t)},t.prototype.some=function(e){return o(this,e)},t._SomePromiseArray=i}},{"./errors":12,"./util":36}],32:[function(e,t,r){"use strict";t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var r=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},n=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=t.prototype.isFulfilled=function(){return 0!==(33554432&this._bitField)},o=t.prototype.isRejected=function(){return 0!==(16777216&this._bitField)},s=t.prototype.isPending=function(){return 0===(50397184&this._bitField)},a=t.prototype.isResolved=function(){return 0!==(50331648&this._bitField)};t.prototype.isCancelled=e.prototype._isCancelled=function(){return 65536===(65536&this._bitField)},e.prototype.isCancelled=function(){return this._target()._isCancelled()},e.prototype.isPending=function(){return s.call(this._target())},e.prototype.isRejected=function(){return o.call(this._target())},e.prototype.isFulfilled=function(){return i.call(this._target())},e.prototype.isResolved=function(){return a.call(this._target())},e.prototype.value=function(){return r.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),n.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t,r){"use strict";t.exports=function(t,r){function n(e,n){if(l(e)){if(e instanceof t)return e;var i=o(e);if(i===c){n&&n._pushContext();var u=t.reject(i.e);return n&&n._popContext(),u}if("function"==typeof i){if(s(e)){var u=new t(r);return e._then(u._fulfill,u._reject,void 0,u,null),u}return a(e,i,n)}}return e}function i(e){return e.then}function o(e){try{return i(e)}catch(t){return c.e=t,c}}function s(e){return h.call(e,"_promise0")}function a(e,n,i){function o(e){a&&(a._resolveCallback(e),a=null)}function s(e){a&&(a._rejectCallback(e,h,!0),a=null)}var a=new t(r),l=a;i&&i._pushContext(),a._captureStackTrace(),i&&i._popContext();var h=!0,f=u.tryCatch(n).call(e,o,s);return h=!1,a&&f===c&&(a._rejectCallback(f.e,!0,!0),a=null),l}var u=e("./util"),c=u.errorObj,l=u.isObject,h={}.hasOwnProperty;return n}},{"./util":36}],34:[function(e,t,r){"use strict";t.exports=function(t,r,n){function i(e){this.handle=e}function o(e){return clearTimeout(this.handle),e}function s(e){throw clearTimeout(this.handle),e}var a=e("./util"),u=t.TimeoutError;i.prototype._resultCancelled=function(){clearTimeout(this.handle)};var c=function(e){return l(+this).thenReturn(e)},l=t.delay=function(e,o){var s,a;return void 0!==o?(s=t.resolve(o)._then(c,null,null,e,void 0),n.cancellation()&&o instanceof t&&s._setOnCancel(o)):(s=new t(r),a=setTimeout(function(){s._fulfill()},+e),n.cancellation()&&s._setOnCancel(new i(a))),s._setAsyncGuaranteed(),s};t.prototype.delay=function(e){return l(e,this)};var h=function(e,t,r){var n;n="string"!=typeof t?t instanceof Error?t:new u("operation timed out"):new u(t),a.markAsOriginatingFromRejection(n),e._attachExtraTrace(n),e._reject(n),null!=r&&r.cancel()};t.prototype.timeout=function(e,t){e=+e;var r,a,u=new i(setTimeout(function(){r.isPending()&&h(r,t,a)},e));return n.cancellation()?(a=this.then(),r=a._then(o,s,void 0,u,void 0),r._setOnCancel(u)):r=this._then(o,s,void 0,u,void 0),r}}},{"./util":36}],35:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o,s){function a(e){setTimeout(function(){throw e},0)}function u(e){var t=n(e);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function c(e,r){function i(){if(s>=c)return l._fulfill();var o=u(e[s++]);if(o instanceof t&&o._isDisposable()){try{o=n(o._getDisposer().tryDispose(r),e.promise)}catch(h){return a(h)}if(o instanceof t)return o._then(i,a,null,null,null)}i()}var s=0,c=e.length,l=new t(o);return i(),l}function l(e,t,r){this._data=e,this._promise=t,this._context=r}function h(e,t,r){this.constructor$(e,t,r)}function f(e){return l.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function p(e){this.length=e,this.promise=null,this[e-1]=null}var d=e("./util"),v=e("./errors").TypeError,_=e("./util").inherits,y=d.errorObj,g=d.tryCatch;l.prototype.data=function(){return this._data},l.prototype.promise=function(){return this._promise},l.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},l.prototype.tryDispose=function(e){var t=this.resource(),r=this._context;void 0!==r&&r._pushContext();var n=null!==t?this.doDispose(t,e):null;return void 0!==r&&r._popContext(),this._promise._unsetDisposable(),this._data=null,n},l.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},_(h,l),h.prototype.doDispose=function(e,t){var r=this.data();return r.call(e,e,t)},p.prototype._resultCancelled=function(){for(var e=this.length,r=0;e>r;++r){var n=this[r];n instanceof t&&n.cancel()}},t.using=function(){var e=arguments.length;if(2>e)return r("you must pass at least 2 arguments to Promise.using");var i=arguments[e-1];if("function"!=typeof i)return r("expecting a function but got "+d.classString(i));var o,a=!0;2===e&&Array.isArray(arguments[0])?(o=arguments[0],e=o.length,a=!1):(o=arguments,e--);for(var u=new p(e),h=0;e>h;++h){var v=o[h];if(l.isDisposer(v)){var _=v;v=v.promise(),v._setDisposable(_)}else{var m=n(v);m instanceof t&&(v=m._then(f,null,null,{resources:u,index:h},void 0))}u[h]=v}for(var b=new Array(u.length),h=0;h<b.length;++h)b[h]=t.resolve(u[h]).reflect();var w=t.all(b).then(function(e){for(var t=0;t<e.length;++t){var r=e[t];if(r.isRejected())return y.e=r.error(),y;if(!r.isFulfilled())return void w.cancel();e[t]=r.value()}k._pushContext(),i=g(i);var n=a?i.apply(void 0,e):i(e),o=k._popContext();return s.checkForgottenReturns(n,o,"Promise.using",k),n}),k=w.lastly(function(){var e=new t.PromiseInspection(w);return c(u,e)});return u.promise=k,k._setOnCancel(u),k},t.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},t.prototype.disposer=function(e){if("function"==typeof e)return new h(e,this,i());throw new v}}},{"./errors":12,"./util":36}],36:[function(t,r,i){"use strict";function o(){try{var e=S;return S=null,e.apply(this,arguments)}catch(t){return j.e=t,j}}function s(e){return S=e,o}function a(e){return null==e||e===!0||e===!1||"string"==typeof e||"number"==typeof e}function u(e){return"function"==typeof e||"object"==typeof e&&null!==e}function c(e){return a(e)?new Error(g(e)):e}function l(e,t){var r,n=e.length,i=new Array(n+1);for(r=0;n>r;++r)i[r]=e[r];return i[r]=t,i}function h(e,t,r){if(!T.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var n=Object.getOwnPropertyDescriptor(e,t);return null!=n?null==n.get&&null==n.set?n.value:r:void 0}function f(e,t,r){if(a(e))return e;var n={value:r,configurable:!0,enumerable:!1,writable:!0};return T.defineProperty(e,t,n),e}function p(e){throw e}function d(e){try{if("function"==typeof e){var t=T.names(e.prototype),r=T.isES5&&t.length>1,n=t.length>0&&!(1===t.length&&"constructor"===t[0]),i=R.test(e+"")&&T.names(e).length>0;if(r||n||i)return!0}return!1}catch(o){return!1}}function v(e){function t(){}t.prototype=e;for(var r=8;r--;)new t;return e}function _(e){return D.test(e)}function y(e,t,r){for(var n=new Array(e),i=0;e>i;++i)n[i]=t+i+r;return n}function g(e){try{return e+""}catch(t){return"[no string representation]"}}function m(e){return null!==e&&"object"==typeof e&&"string"==typeof e.message&&"string"==typeof e.name}function b(e){try{f(e,"isOperational",!0)}catch(t){}}function w(e){return null==e?!1:e instanceof Error.__BluebirdErrorTypes__.OperationalError||e.isOperational===!0}function k(e){return m(e)&&T.propertyIsWritable(e,"stack")}function C(e){return{}.toString.call(e)}function E(e,t,r){for(var n=T.names(e),i=0;i<n.length;++i){var o=n[i];if(r(o))try{T.defineProperty(t,o,T.getDescriptor(e,o))}catch(s){}}}function P(t,r){return U?e.env[t]:r}var T=t("./es5"),F="undefined"==typeof navigator,j={e:{}},S,O="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof n?n:void 0!==this?this:null,x=function(e,t){function r(){this.constructor=e,this.constructor$=t;for(var r in t.prototype)n.call(t.prototype,r)&&"$"!==r.charAt(r.length-1)&&(this[r+"$"]=t.prototype[r])}var n={}.hasOwnProperty;return r.prototype=t.prototype,e.prototype=new r,e.prototype},A=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var r=0;r<e.length;++r)if(e[r]===t)return!0;return!1};if(T.isES5){var r=Object.getOwnPropertyNames;return function(e){for(var n=[],i=Object.create(null);null!=e&&!t(e);){var o;try{o=r(e)}catch(s){return n}for(var a=0;a<o.length;++a){var u=o[a];if(!i[u]){i[u]=!0;var c=Object.getOwnPropertyDescriptor(e,u);null!=c&&null==c.get&&null==c.set&&n.push(u)}}e=T.getPrototypeOf(e)}return n}}var n={}.hasOwnProperty;return function(r){if(t(r))return[];var i=[];e:for(var o in r)if(n.call(r,o))i.push(o);else{for(var s=0;s<e.length;++s)if(n.call(e[s],o))continue e;i.push(o)}return i}}(),R=/this\s*\.\s*\S+\s*=/,D=/^[a-z$_][a-z$_0-9]*$/i,L=function(){return"stack"in new Error?function(e){return k(e)?e:new Error(g(e))}:function(e){if(k(e))return e;try{throw new Error(g(e))}catch(t){return t}}}(),I=function(e){return T.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var H="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,r=[],n=e[Symbol.iterator]();!(t=n.next()).done;)r.push(t.value);return r};I=function(e){return T.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?H(e):null}}var U="undefined"!=typeof e&&"[object process]"===C(e).toLowerCase(),N={isClass:d,isIdentifier:_,inheritedDataKeys:A,getDataPropertyOrDefault:h,thrower:p,isArray:T.isArray,asArray:I,notEnumerableProp:f,isPrimitive:a,isObject:u,isError:m,canEvaluate:F,errorObj:j,tryCatch:s,inherits:x,withAppended:l,maybeWrapAsError:c,toFastProperties:v,filledRange:y,toString:g,canAttachTrace:k,ensureErrorObject:L,originatesFromRejection:w,markAsOriginatingFromRejection:b,classString:C,copyDescriptors:E,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:U,env:P,global:O};N.isRecentNode=N.isNode&&function(){var t=e.versions.node.split(".").map(Number);return 0===t[0]&&t[1]>10||t[0]>0}(),N.isNode&&N.toFastProperties(e);try{throw new Error}catch(B){N.lastLineError=B}r.exports=N},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:2}],2:[function(e,t,r){function n(){l=!1,a.length?c=a.concat(c):h=-1,c.length&&i()}function i(){if(!l){var e=setTimeout(n);l=!0;for(var t=c.length;t;){for(a=c,c=[];++h<t;)a&&a[h].run();h=-1,t=c.length}a=null,l=!1,clearTimeout(e)}}function o(e,t){this.fun=e,this.array=t}function s(){}var a,u=t.exports={},c=[],l=!1,h=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new o(e,t)),1!==c.length||l||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=s,u.addListener=s,u.once=s,u.off=s,u.removeListener=s,u.removeAllListeners=s,u.emit=s,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],3:[function(e,t,r){"use strict";function n(){var e=[],t=0;this.getLength=function(){return e.length-t},this.isEmpty=function(){return 0===e.length},this.enqueue=function(t){e.push(t)},this.tail=function(){var t=e.length;if(0!==t)return e[t-1]},this.dequeue=function(){if(0!==e.length){var r=e[t];return e[t]=null,2*++t>=e.length&&(e=e.slice(t),t=0),r}},this.peek=function(){return e.length>0?e[t]:void 0}}t.exports=n},{}],4:[function(e,t,r){"use strict";var n=e("./chromeApp"),i=null;chrome.runtime.onConnectExternal.addListener(function(e){i?i.addPort(e):i=new n(e)}),chrome.runtime.onConnect.addListener(function(e){i?i.addPort(e):console.log("cannot connect app to popup")}),chrome.app.runtime.onLaunched.addListener(function(e){i||(console.log("Launching app"),i=new n(null)),i.showOrCreateWindow()})},{"./chromeApp":5}],5:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=(e("bluebird"),e("./chromeFlash")),s=e("./progress"),a=e("./settings"),u=(e("./log"),function(){function e(t){n(this,e),this.ports=new Set,this.document=null,this.flashInProgress=!1,this.done=!1,this.flashSrc=void 0,this.progress=new s,this.chromeFlash=new o(this.progress),t&&this.addPort(t),this.addObservers(),this.pollForDeviceChanges()}return i(e,[{key:"pollForDeviceChanges",value:function(){var e=this;setInterval(function(){e.flashInProgress||e.done||e.chromeFlash.getDeviceCount()},1e3)}},{key:"addObservers",value:function(){var e=this,t=this;this.progress.addDeviceObserver(function(t){e.postMessage({devices:t})}),this.progress.addProgressObserver(function(t){e.postMessage({progress:t})}),this.progress.addStateObserver(function(e){(e.state===s.FAIL_STATE||e.state===s.PASS_STATE)&&(t.flashInProgress=!1,t.done=!0),t.postMessage({stateUpdate:e})})}},{key:"addPort",value:function(e){this.ports.add(e),this.addPortListeners(e),this.chromeFlash.getDeviceCount()}},{key:"removePort",value:function(e){this.ports["delete"](e)}},{key:"postMessage",value:function(e,t){if(t)this.ports.has(t)&&t.postMessage(e);else{var r=!0,n=!1,i=void 0;try{for(var o,s=this.ports[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var a=o.value;a.postMessage(e)}}catch(u){n=!0,i=u}finally{try{!r&&s["return"]&&s["return"]()}finally{if(n)throw i}}}}},{key:"createWindow",value:function(){var e=this;chrome.app.window.create("popup.html",{innerBounds:{width:640,height:700}},function(t){e.appWindow=t,e.appWindow.onClosed.addListener(function(){e.document=null,e.appWindow=null,e.flashInProgress&&e.chromeFlash.cancel()});var r=e.appWindow.contentWindow;r.flashSrc=e.flashSrc,r.flashTitle=e.flashTitle,r.maxChips=a.MAX_CHIPS,r.onload=function(){e.document=r.document}})}},{key:"addPortListeners",value:function(e){var t=this,r=this;e.onMessage.addListener(function(n,i){if(n.ping?t.postMessage({connect:!0},e):n.deviceCount?t.chromeFlash.getDeviceCount():t.flashInProgress||!n.flashSrc&&!n.localFile||(t.stub=n.stub,t.flashSrc=null,n.flashSrc&&(t.flashSrc=n.flashSrc,t.flashTitle=n.flashTitle),t.done=!1,t.showOrCreateWindow()),n.startFlashing)if(t.progress.init(),t.flashInProgress=!0,t.progress.notifyProgress(),t.flashSrc)t.chromeFlash.flashFromUrl(t.flashSrc,t.stub);else{var o=r.appWindow.contentWindow.localFile;t.chromeFlash.flashFromFile(o,t.stub)}}),e.onDisconnect.addListener(function(t){r.removePort(e)})}},{key:"showOrCreateWindow",value:function(){this.appWindow?this.appWindow.show(!0):this.createWindow()}}]),e}());t.exports=u},{"./chromeFlash":6,"./log":13,"./progress":14,"./settings":16,bluebird:1}],6:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=(e("bluebird"),e("./dataProcessor")),s=e("./stubUsb"),a=e("./chromeUsb"),u=e("./readableStreamHandler"),c=e("./fileHandler"),l=e("./log"),h=function(){function e(t,r){n(this,e),this.progress=t,this.deviceHandler=new a,this.isWindows=-1!==navigator.appVersion.indexOf("Win")}return i(e,[{key:"onDeviceAddRemove",value:function(e){this.getDeviceCount()}},{key:"getDeviceCount",value:function(e,t){var r=this;return e=e||7994,t=t||61416,this.deviceHandler?void this.deviceHandler.getDevicesPromise(e,t).then(function(t){var n=t.length;n?r.progress.notifyDeviceCount(n):r.deviceHandler.getDevicesPromise(e,4112).then(function(e){r.progress.notifyDeviceCount(e.length)})}):0}},{key:"prepareFlash",value:function(e){var t=this.deviceHandler;"1"==e&&(t=new s),this.dataProcessor=new o(t,this.progress)}},{key:"flashFromUrl",value:function(e,t){this.prepareFlash(t);var r=new u(this.dataProcessor,5e6);r.doFetch(e)}},{key:"flashFromFile",value:function(e,t){l.meta("Flash from File "+e+" stub"+t),this.prepareFlash(t);var r=new c(this.dataProcessor,5e6);r.fetchFile(e)}},{key:"cancel",value:function(){this.dataProcessor.handleError("User Cancel"),console.log("ChromeFlash.cancel(): User has cancelled flash!")}}]),e}();t.exports=h},{"./chromeUsb":7,"./dataProcessor":9,"./fileHandler":12,"./log":13,"./readableStreamHandler":15,"./stubUsb":18,bluebird:1}],7:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("bluebird"),u=e("./log"),c=e("./deviceHandlerInterface"),l=function(e){function t(){n(this,t);var e=i(this,Object.getPrototypeOf(t).call(this));return e.timeout=3e5,e.configurationValue=1,e}return o(t,e),s(t,[{key:"getDevicesPromise",value:function(e,t){var r={};r.vendorId=e,r.productId=t;var n={filters:[r]};return new a(function(e,t){chrome.usb.getDevices(n,function(r){return chrome.runtime.lastError?t(new Error(chrome.runtime.lastError.message)):void e(r)})})}},{key:"openChipPromise",value:function(e){var t=this;return new a(function(t,r){chrome.usb.openDevice(e.device,function(n){return chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):(e.handle=n,void t(n))})}).then(function(r){return new a(function(n,i){chrome.usb.getConfigurations(e.device,function(e){if(chrome.runtime.lastError)return i(new Error(chrome.runtime.lastError.message));var o=t.configurationValue;return e&&e.length>0?(u.info("Configuration count"+e.length),o=e[0].configurationValue,u.info("USB Config value="+o),void n([r,o])):(u.error("No USB config found."),i(new Error(t.NO_CONFIG)))})})}).then(function(e){var t=e[0],r=e[1];return new a(function(e,n){chrome.usb.setConfiguration(t,r,function(){return chrome.runtime.lastError?(u.error("Could not set configuration to "+r),n(new Error(chrome.runtime.lastError.message))):(u.info("Set usb device configuration to "+r),void e(t))})})}).then(function(e){return new a(function(t,r){chrome.usb.listInterfaces(e,function(n){return chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):void t([e,n])})})}).then(function(r){var n=r[0],i=r[1],o=null,s=!0,u=!1,c=void 0;try{for(var l,h=i[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var f=l.value,p=f.endpoints,d=!0,v=!1,_=void 0;try{for(var y,g=p[Symbol.iterator]();!(d=(y=g.next()).done);d=!0){var m=y.value;"bulk"===m.type&&("in"===m.direction?(e.inEp=m,o=f):"out"===m.direction&&(e.outEp=m,o=f))}}catch(b){v=!0,_=b}finally{try{!d&&g["return"]&&g["return"]()}finally{if(v)throw _}}if(o){if(null===e.inEp||null===e.outEp)throw new Error(t.COULD_NOT_CLAIM_INTERFACES);break}}}catch(b){u=!0,c=b}finally{try{!s&&h["return"]&&h["return"]()}finally{if(u)throw c}}return new a(function(e,t){chrome.usb.claimInterface(n,o.interfaceNumber,function(){return chrome.runtime.lastError?t(new Error(chrome.runtime.lastError.message)):void e(n)})})})["catch"](function(r){if(u.error("caught usb config error"+r),e.handle)return t.closePromise(e).then(function(){return null});throw r})}},{key:"writePromise",value:function(e,t){var r={};return r.direction="out",r.endpoint=e.outEp.address,r.data=t.buffer,r.length=t.byteLength,r.timeout=this.timeout,new a(function(n,i){chrome.usb.bulkTransfer(e.handle,r,function(e){return chrome.runtime.lastError?(u.error("Error writing"),u.error(chrome.runtime.lastError),i(new Error(chrome.runtime.lastError.message))):void n(0===e.resultCode?t.byteLength:0)})})}},{key:"readPromise",value:function(e,t){var r={};return r.direction="in",r.endpoint=e.inEp.address,r.length=t.byteLength,r.timeout=this.timeout,new a(function(t,n){chrome.usb.bulkTransfer(e.handle,r,function(e){return chrome.runtime.lastError?(u.error("Error reading"),u.error(chrome.runtime.lastError),n(new Error(chrome.runtime.lastError.message))):void t(0===e.resultCode?new Uint8Array(e.data):null)})})}},{key:"closePromise",value:function(e){return new a(function(t,r){chrome.usb.closeDevice(e.handle,function(){return e.init(),chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):void t(!0)})})}},{key:"resetPromise",value:function(e){return new a(function(t,r){chrome.usb.resetDevice(e.handle,function(){return e.init(),chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):void t(!0)})})}}]),t}(c);t.exports=l},{"./deviceHandlerInterface":11,"./log":13,bluebird:1}],8:[function(e,t,r){"use strict";function n(e){return o.info("Erasing NAND in fastboot"),e.write("erase:UBI").then(function(){return e.read("OKAY",!0)}).then(function(e){if(!e)throw new Error("erase:UBI not OKAY");return e})}function i(e){return s.arrayBufferEquals(a,e,!0)}var o=(e("bluebird"),e("./log")),s=e("./util"),a=s.stringToArr("continue");t.exports={eraseUBI:n,isContinue:i}},{"./log":13,"./util":19,bluebird:1}],9:[function(e,t,r){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function L(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:L(i,t,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("bluebird"),c=e("./log"),l=e("./Queue"),h=e("./dataTransferHandler"),f=e("./progress"),p=e("./util"),d=e("./settings"),v=e("./commands"),_=2,y=0,g=1,m=2,b=3,w=4,k=523956200,C=523898896,E=3978755898,P=function(){function e(t,r){o(this,e),this.dataProcessor=t,this.dataLength=r,this.id=++t.expectCount}return a(e,[{key:"clean",value:function(){this.dataProcessor=null,this.buffer=null}},{key:"parseAndGetNext",value:function(e){return this.buffer=e,new F(this.dataProcessor)}},{key:"process",value:function(){return!0}},{key:"isPlayedBack",value:function(){return!0}},{key:"isUncompressedWrite",value:function(){return!1}},{key:"kind",value:function(){return"Expect"}}]),e}(),T=function(e){function t(e,r){o(this,t);var i=n(this,Object.getPrototypeOf(t).call(this,e,0));return i.fn=r,i}return i(t,e),a(t,[{key:"process",value:function(){var e=this;return u.resolve().then(function(){return e.fn()})}},{key:"kind",value:function(){return"ExpectMeta"}}]),t}(P),F=function(e){function t(e,r){o(this,t);var i=n(this,Object.getPrototypeOf(t).call(this,e,12));return i.first=r,i}return i(t,e),a(t,[{key:"parseMagicNumberAndEndian",value:function(e){c.debug("Parsing magic and endian");for(var t=0,r=[!0,!1],n=0;n<r.length;n++){var i=r[n],o=new DataView(e.buffer,0,4);if(t=o.getUint32(0,i),c.debug(t.toString(16)),t===k){c.debug("Reading FEL Data");break}if(t===C){c.debug("Reading FASTBOOT Data");break}if(0===t)c.debug("Ignoring 0 magic");else{if(t===E)throw c.debug("The file is a sparse file. It must be processed with howitzer"),new Error("Bad file format. This is a raw sparse file");if(!i)throw c.debug("Uh oh The file is not valid"),"Bad file format"}}return[t,i]}},{key:"parseAndGetNext",value:function(e){var t=new DataView(e.buffer,4,3),r=t.getUint8(0);this.command=r;var n=null;if(this.first||r===y){var i=this.parseMagicNumberAndEndian(e);n=i[0],this.dataProcessor.endian=i[1]}var o=this.dataProcessor.endian,s=new DataView(e.buffer,0,4),a=s.getUint32(0,o),u=t.getUint8(1),l=parseInt(t.getUint8(2));s=new DataView(e.buffer,8,4);var h=s.getUint32(0,o);return l>_&&(c.error(this),c.error(l+" "+u+" "+a+" "+h+" "+t.getUint8(2)),c.error("Recorder version="+l+" Player version="+_),this.dataProcessor.badVer=!0),r===y?new j(this.dataProcessor,n,h,l):r===g?new O(this.dataProcessor,h):r===w?new R(this.dataProcessor,a):r===m?new x(this.dataProcessor,u,h):r===b?new A(this.dataProcessor,u,h):void 0}},{key:"isPlayedBack",value:function(){return!1}},{key:"kind",value:function(){return this.id+" ExpectHeader"}}]),t}(P),j=function(e){function t(e,r,i,s){o(this,t);var a=n(this,Object.getPrototypeOf(t).call(this,e,0));return a.magicNumber=r,a.recorderVersion=s,a.fileLength=i,a}return i(t,e),a(t,[{key:"parseAndGetNext",value:function(e){return this.magicNumber!==this.dataProcessor.magicNumber&&((1===this.recorderVersion||0===this.dataProcessor.totalBytes)&&this.dataProcessor.addTotalBytes(this.fileLength),this.dataProcessor.magicNumber=this.magicNumber,c.debug("file length: "+this.fileLength)),new F(this.dataProcessor)}},{key:"vidPid",value:function(){return p.magicToVidPid(this.magicNumber)}},{key:"waitTimeout",value:function(){return this.magicNumber===k?1e4:this.magicNumber===C?35e3:void 0}},{key:"magicLabel",value:function(e,t){return e===k?t?f.WAITING_FOR_FEL:f.FEL:e===C?t?f.WAITING_FOR_FASTBOOT:f.FASTBOOT:void 0}},{key:"process",value:function(){var e=this,t=this.vidPid(),r=this.dataProcessor;r.progress.notifyStage(this.magicLabel(this.magicNumber,!0));var n=r.dataTransferHandler,i=n.waitForStatePromise(t[0],t[1],r.flashingCount,this.waitTimeout()).then(function(t){return c.info("---Process magic "+(e.magicNumber===C?" Fastboot":"FEL")),t?(r.progress.notifyStage(e.magicLabel(e.magicNumber,!1)),!0):!1});return r.skipUntilMagic===this.magicNumber&&(r.skipUntilMagic=null,i.then(function(){return v.eraseUBI(n)})),r.firstMagic=r.firstMagic||this.magicNumber,r.lastMagic=this.magicNumber,i}},{key:"kind",value:function(){return this.id+" MAGIC"}}]),t}(P),S=function(e){function t(e,r){return o(this,t),n(this,Object.getPrototypeOf(t).call(this,e,r,0,0))}return i(t,e),a(t,[{key:"process",value:function(){var e=this,t=this.vidPid();return this.dataProcessor.deviceHandler.getDevicesPromise(t[0],t[1]).then(function(t){c.info("Magic check"),t.length>0&&(e.dataProcessor.skipUntilMagic=e.magicNumber)})}},{key:"parseAndGetNext",value:function(e){return null}},{key:"kind",value:function(){return this.id+" MAGIC CHECK"}}]),t}(j),O=function(e){function t(e,r){return o(this,t),n(this,Object.getPrototypeOf(t).call(this,e,r))}return i(t,e),a(t,[{key:"process",value:function(){return u.resolve(this.buffer).then(function(e){return c.info("Comment: "+p.arrToString(e)),!0})}},{key:"kind",value:function(){return this.id+" ExpectComment"}}]),t}(P),x=function(e){function t(e,r,i){o(this,t);var s=n(this,Object.getPrototypeOf(t).call(this,e,i));return s.compressed=r,s.allowFailure=!1,s.dataProcessor.continueReached&&(s.allowFailure=!0),s}return i(t,e),a(t,[{key:"process",value:function(){return this.dataProcessor.dataTransferHandler.readPromise(this.buffer,this.id,this.allowFailure)}},{key:"kind",value:function(){return this.id+" ExpectRead "+this.dataLength}}]),t}(P),A=function(e){function t(e,r,i){o(this,t);var s=n(this,Object.getPrototypeOf(t).call(this,e,i));return s.compressed=r,s}return i(t,e),a(t,[{key:"parseAndGetNext",value:function(e){return v.isContinue(e)&&(c.info("Continue reached"),this.dataProcessor.continueReached=!0),s(Object.getPrototypeOf(t.prototype),"parseAndGetNext",this).call(this,e)}},{key:"process",value:function(){return this.dataProcessor.dataTransferHandler.writePromise(this.buffer,this.id)}},{key:"isUncompressedWrite",value:function(){return!this.compressed}},{key:"kind",value:function(){return this.id+" ExpectWrite "+this.dataLength}}]),t}(P),R=function(e){function t(e,r){o(this,t);var i=n(this,Object.getPrototypeOf(t).call(this,e,0));return i.microseconds=r,i}return i(t,e),a(t,[{key:"process",value:function(){return u.delay(this.microseconds/1e3)}},{key:"kind",value:function(){return this.id+" Usleep"}}]),t}(P),D=function(){function e(t,r){o(this,e),this.deviceHandler=t,this.dataTransferHandler=new h(t),this.progress=r,this.initialize(),this.state=null}return a(e,[{key:"initialize",value:function(){this.expectCount=0,this.dataTransferHandler.initialize(),this.littleEndian=!1,this.readBuffer=null,this.expect=new F(this,!0),this.totalBytes=0,this.bytesWritten=0,this.enqueuedItems=0,this.queue=new l,this.head=null,this.magicNumber=0,this.skipUntilMagic=null,this.continueReached=!1,this.setState(f.PASSIVE_STATE),this.firstMagic=null,this.lastMagic=null,this.setInitialDeviceCount(),this.checkForFastboot()}},{key:"setInitialDeviceCount",value:function(){var e=this;this.addMeta(function(){return e.dataTransferHandler.getDeviceCount2(k,C).then(function(t){return e.initialDeviceCount=t,t>d.MAX_CHIPS&&(t=d.MAX_CHIPS,e.notifyState(new Error("C.H.I.P.s detected = "+t+", but can only flash "+d.MAX_CHIPS))),e.flashingCount=t,t})})}},{key:"checkForFastboot",value:function(){var e=new S(this,C);this.addToQueue(e)}},{key:"startedWithFastboot",value:function(){return this.firstMagic===C}},{key:"setState",value:function(e){e!==this.state&&(this.state=e,this.notifyState(e))}},{key:"addTotalBytes",value:function(e){this.totalBytes+=e,this.progress.setTotalBytes(this.totalBytes)}},{key:"setStreamHandler",value:function(e){this.streamHandler=e}},{key:"addToQueue",value:function(e){var t=!1;t||(this.enqueuedItems++,c.info("added "+e.kind()+" len "+e.dataLength+" to queue. items="+this.enqueuedItems),this.queue.enqueue(e),1===this.queue.getLength()&&(c.debug("processing head"),this.processHead())),e.dataLength>0&&this.streamHandler.addBytes(e.dataLength);
}},{key:"removeFromQueue",value:function(e){return this.state!==f.FAIL_STATE?(this.enqueuedItems--,e.clean(),this.queue.dequeue(),c.info("removed "+e.kind()+" len "+e.dataLength+" from queue. Now at  "+this.streamHandler.enqueuedBytes+"bytes, items="+this.enqueuedItems),this.processHead(),this.progress.addBytes(e.dataLength,this.enqueuedItems),this.streamHandler.addBytes(-e.dataLength),!0):void 0}},{key:"addMeta",value:function(e){this.addToQueue(new T(this,e))}},{key:"addCleanUpMeta",value:function(e){var t=this;this.addMeta(function(){return t.cleanUpPromise().then(function(){return c.meta("Flashing finished! Elapsed time: "+((new Date).getTime()-e)/1e3),!0})})}},{key:"processHead",value:function(){var e=this;if(this.dataTransferHandler.errorState)return console.log("aborting in processHead"),this.handleError(this.dataTransferHandler.errorState);if(this.head=this.queue.peek(),this.head){if(this.skipUntilMagic&&this.head.magicNumber!==this.skipUntilMagic)return void this.removeFromQueue(this.head);this.head.process()["catch"](Error,function(t){return console.log("caught error in process head and calling handlError"+t),e.handleError(t)}).then(function(){return e.removeFromQueue(e.head)})}}},{key:"handleError",value:function(e){if(this.state===f.FAIL_STATE)return!1;c.error("Handling error"),c.error(e),this.state=f.FAIL_STATE;var t={error:e};return this.head&&(t.index=this.head.id,t.operation=this.head.kind()),c.error(t),this.queue=new l,this.notifyState(t),this.cleanUpPromise().then(function(){return c.error("cleaned up after error"),!0})}},{key:"notifyState",value:function(e){var t={state:this.state};e&&(t.error=e),t.startedWithFastboot=this.startedWithFastboot(),t.booting=this.continueReached,t.initialDeviceCount=this.initialDeviceCount,t.flashingCount=this.flashingCount,this.progress.notifyState(t)}},{key:"cleanUpPromise",value:function(){var e=this;return this.dataTransferHandler.closeAllExcept(0,0)["catch"](function(e){return c.error("Error on cleanup"),c.error(e),null}).then(function(){return c.info("Closed all devices"),e.state!==f.FAIL_STATE&&(e.state=f.PASS_STATE,e.notifyState()),e.progress.notifyStage(f.DONE),!0})}},{key:"processChunk",value:function(e){if(this.state===f.FAIL_STATE)return!1;this.setState(f.ACTIVE_STATE),this.readBuffer?this.readBuffer=p.appendBuffer(this.readBuffer,e):this.readBuffer=e;for(var t=this.enqueuedItems;this.readBuffer.byteLength>=this.expect.dataLength;){var r=this.expect,n=null;r.dataLength>0&&(n=this.readBuffer.slice(0,r.dataLength),this.readBuffer=this.readBuffer.slice(r.dataLength)),this.expect=r.parseAndGetNext(n),r.isPlayedBack()&&this.addToQueue(r)}return c.debug("after process chunk, added="+(this.enqueuedItems>t)+" head="+this.head),!0}}]),e}();t.exports=D},{"./Queue":3,"./commands":8,"./dataTransferHandler":10,"./log":13,"./progress":14,"./settings":16,"./util":19,bluebird:1}],10:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=e("bluebird"),s=e("./log"),a=e("./util"),u=0,c=2e3,l=function(){function e(t){n(this,e),this.device=t,this.init()}return i(e,[{key:"init",value:function(){this.handle=null,this.inEp=null,this.outEp=null,this.writeIndex=0,this.state=u}},{key:"magicNumber",value:function(){return(this.vid<<16)+this.pid}}]),e}(),h=function(){function e(t){n(this,e),this.deviceHandler=t,this.initialize()}return i(e,[{key:"initialize",value:function(){this.chips=[],this.errorState=null}},{key:"waitForStatePromise",value:function(e,t,r,n){r=r||1,n=n||2e4;var i=this;return o.resolve().then(function(){if(i.chips&&i.chips.length>0){for(var o=0,u=0;r>u;u++)e===i.chips[u].vid&&t===i.chips[u].pid&&o++;if(o===r)return!0}var c=function(){return i.openAllPromise(e,t,r).then(function(e){return e&&e.length===r})}.bind(i);return i.closeAllExcept(e,t).then(function(){return a.pollPromise(c,1e3,n)}).then(function(r){return s.debug("Just polled for device "+e.toString(16)+":"+t.toString(16)),r})})}},{key:"openAllPromise",value:function(e,t,r){var n=this,i=this;return this.chips=[],this.deviceHandler.getDevicesPromise(e,t).then(function(n){return n.length<r?null:(n=n.slice(0,r),o.delay(r*c).then(function(){return o.map(n,function(r){var n=new l(r);return i.chips.push(n),n.vid=e,n.pid=t,i.deviceHandler.openChipPromise(n)})}))}).then(function(e){if(e){var t=!0,r=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(t=(o=s.next()).done);t=!0){var a=o.value;if(!a)return n.initialize(),null}}catch(u){r=!0,i=u}finally{try{!t&&s["return"]&&s["return"]()}finally{if(r)throw i}}}return e})}},{key:"closeAllExcept",value:function(e,t){var r=this,n=[],i=[],s=!0,a=!1,u=void 0;try{for(var c,l=this.chips[Symbol.iterator]();!(s=(c=l.next()).done);s=!0){var h=c.value;h.vid!==e||h.pid!==t?n.push(this.deviceHandler.closePromise(h)):i.push(h)}}catch(f){a=!0,u=f}finally{try{!s&&l["return"]&&l["return"]()}finally{if(a)throw u}}var p=o.all(n).then(function(){r.chips=i});return p.dbg="closeAllExcept "+e.toString(16)+":"+t.toString(16),p}},{key:"writePromise",value:function(e,t){t=t||0;var r=this.deviceHandler.writePromise(this.chips[0],e);return r.dbg="writePromise "+t,r}},{key:"readPromise",value:function(e,t,r){var n=this;t=t||0;var i=this.deviceHandler.readPromise(this.chips[0],e);return i.then(function(i){if(a.arrayBufferEquals(i,e,!0))return i;if(r)return e;throw s.error("BAD READ index "+t+"failed to read back correctly"),s.error("read: "+a.arrToString(i)+" expecting "+a.arrToString(e)),n.errorState=new Error("bad read back "+t),n.errorState})["catch"](function(t){if(r)return e;throw t}),i.dbg="readPromise "+t,i}},{key:"write",value:function(e){return this.writePromise(a.stringToArr(e))}},{key:"read",value:function(e,t){return this.readPromise(a.stringToArr(e)).then(function(r){return t?a.arrayBufferEquals(e,r,!0):a.arrToString(r)})}},{key:"getDeviceCount",value:function(e){var t=a.magicToVidPid(e);return this.deviceHandler.getDevicesPromise(t[0],t[1]).then(function(e){return e.length})}},{key:"getDeviceCount2",value:function(e,t){var r=this;return this.getDeviceCount(e).then(function(e){return e?e:r.getDeviceCount(t)})}}]),e}();t.exports=h},{"./log":13,"./util":19,bluebird:1}],11:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(){n(this,e)}return i(e,[{key:"getDevicesPromise",value:function(e,t){throw"not implemented"}},{key:"openChipPromise",value:function(e){throw"not implemented"}},{key:"writePromise",value:function(e,t){throw"not implemented"}},{key:"readPromise",value:function(e,t){throw"not implemented"}},{key:"closePromise",value:function(e){throw"not implemented"}}]),e}();t.exports=o},{}],12:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(e("bluebird"),e("./streamHandler")),u=(e("./log"),e("./util"),function(e){function t(e,r){n(this,t);var o=i(this,Object.getPrototypeOf(t).call(this,e,r));return o.pausable=!1,o.offset=0,o.chunkSize=32768,o.file=null,o.fileReader=new FileReader,o.fileReader.onload=o.onLoad.bind(o),o}return o(t,e),s(t,[{key:"onLoad",value:function(e){var t=this.dataProcessor;return e.target.error?void t.handleError(e.target.error):(this.offset+=e.target.result.byteLength,t.processChunk(new Uint8Array(e.target.result)),this.offset>=this.fileSize?void t.addCleanUpMeta(this.startTime):void(this.pausable&&this.paused||this.read()))}},{key:"read",value:function(){var e=this.file.slice(this.offset,this.chunkSize+this.offset);this.fileReader.readAsArrayBuffer(e)}},{key:"fetchFile",value:function(e){this.file=e,this.fileSize=e.size,this.read()}}]),t}(a));t.exports=u},{"./log":13,"./streamHandler":17,"./util":19,bluebird:1}],13:[function(e,t,r){"use strict";var n={debug:function(e){i&&console.log(e)},error:function(e){o&&console.log(e)},info:function(e){s&&console.log(e)},meta:function(e){a&&console.log(e)}},i=!1,o=!0,s=!1,a=!0;t.exports=n},{}],14:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(){n(this,e),this.init(),this.cleanUp()}return i(e,[{key:"init",value:function(){this.currentPercent=0,this.totalBytes=0,this.bytes=0,this.start=null,this.lastKnownStage=null,this.lastCount=0}},{key:"cleanUp",value:function(){this.progressObservers=[],this.deviceObservers=[],this.stateObservers=[]}},{key:"addProgressObserver",value:function(e){this.progressObservers.push(e)}},{key:"addDeviceObserver",value:function(e){this.deviceObservers.push(e)}},{key:"addStateObserver",value:function(e){this.stateObservers.push(e)}},{key:"setTotalBytes",value:function(e){this.totalBytes=e}},{key:"addBytes",value:function(e,t){var r=!this.start;this.start||(this.start=(new Date).getTime()),this.bytes+=e;var n=Math.floor(100*this.bytes/this.totalBytes);100===n&&0!==t&&(n=99),(r||n!==this.currentPercent)&&(this.currentPercent=n,this.notifyProgress())}},{key:"notifyProgress",value:function(){var e=(new Date).getTime()-this.start,t=this.bytes||1,r=e*this.totalBytes/t-e,n={bytes:this.bytes,totalBytes:this.totalBytes,percent:this.currentPercent,estimatedTimeRemaining:r},i=!0,o=!1,s=void 0;try{for(var a,u=this.progressObservers[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var c=a.value;c(n)}}catch(l){o=!0,s=l}finally{try{!i&&u["return"]&&u["return"]()}finally{if(o)throw s}}}},{key:"notifyDeviceCount",value:function(t,r){var n={count:t,maxChips:r},i=!0,o=!1,s=void 0;try{for(var a,u=this.deviceObservers[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var c=a.value;c(n)}}catch(l){o=!0,s=l}finally{try{!i&&u["return"]&&u["return"]()}finally{if(o)throw s}}0!==t&&0===this.lastCount&&this.notifyState({state:e.PASSIVE_STATE,stage:e.WAITING}),this.lastCount=t}},{key:"notifyStage",value:function(e){var t={stage:e};this.lastKnownStage=e,this.notifyState(t)}},{key:"notifyState",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=this.stateObservers[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;s(e)}}catch(a){r=!0,n=a}finally{try{!t&&o["return"]&&o["return"]()}finally{if(r)throw n}}}}]),e}();o.DISCONNECTED_STATE=-1,o.PASSIVE_STATE=0,o.ACTIVE_STATE=1,o.PAUSED_STATE=2,o.PROMPT_STATE=3,o.PASS_STATE=4,o.FAIL_STATE=5,o.IDLE_STATE=6,o.DONE="Done",o.WAITING="Waiting",o.WAITING_FOR_FEL="Waiting for FEL",o.FEL="Processing FEL",o.WAITING_FOR_FASTBOOT="Waiting for Fastboot",o.FASTBOOT="Processing Fastboot",o.NEED_TO_UPDATE_APP="You need to update the App. Go to chrome://extensions and click 'Update extensions now'",t.exports=o},{}],15:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(e("bluebird"),e("./streamHandler")),u=e("./log"),c=(e("./util"),function(e){function t(e,r){n(this,t);var o=i(this,Object.getPrototypeOf(t).call(this,e,r));return o.pausable=!1,o}return o(t,e),s(t,[{key:"doFetch",value:function(e){var t=this,r={mode:"cors",redirect:"follow"};u.info("Doing fetch "+e),fetch(e,r).then(function(e){return t.readableStream=e.body.getReader(),t.read()})["catch"](function(e){return console.log("doFetch error"),u.error(e),t.dataProcessor.handleError(e),null})}},{key:"readWithRetries",value:function(){return this.readableStream.read()}},{key:"read",value:function(){u.debug("read()");var e=this;this.readWithRetries().then(function t(r){return r&&r.done?(u.debug("done"),void e.dataProcessor.addCleanUpMeta(e.startTime)):r&&e.dataProcessor.processChunk(r.value)?e.pausable&&e.paused?null:e.readWithRetries().then(t):(u.error("Aborting on error"),e.readableStream.cancel&&e.readableStream.cancel(),e.dataProcessor.cleanUpPromise().then(function(){throw u.meta("FAILURE!======== Elapsed time: "+((new Date).getTime()-e.startTime)/1e3),new Error("Some error")}))}.bind(this))}}]),t}(a));t.exports=c},{"./log":13,"./streamHandler":17,"./util":19,bluebird:1}],16:[function(e,t,r){"use strict";var n=1;t.exports={MAX_CHIPS:n}},{}],17:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=e("./log"),s=function(){function e(t,r){n(this,e),this.dataProcessor=t,this.dataProcessor.setStreamHandler(this),this.enqueuedByteLimit=r||Number.MAX_VALUE,this.paused=!1,this.enqueuedBytes=0,this.startTime=(new Date).getTime()}return i(e,[{key:"addBytes",value:function(e){this.enqueuedBytes+=e,e>0&&this.enqueuedBytes>=this.enqueuedByteLimit&&this.highWaterMark(!0),0>e&&this.enqueuedBytes<this.enqueuedByteLimit&&this.highWaterMark(!1)}},{key:"highWaterMark",value:function(e){this.defaultHighWaterMark(e)}},{key:"defaultHighWaterMark",value:function(e){this.pausable&&(o.debug("Highwater="+e),e?this.paused||(this.paused=!0,o.debug("Pausing read----------------------")):this.paused&&(this.paused=!1,o.debug("Resuming read-------------------------"),this.read()))}}]),e}();t.exports=s},{"./log":13}],18:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("bluebird"),u=(e("./log"),e("./util")),c=e("./deviceHandlerInterface"),l=function(e){function t(){n(this,t);var e=i(this,Object.getPrototypeOf(t).call(this));return console.log("using stub usb"),e}return o(t,e),s(t,[{key:"getDevicesPromise",value:function(e,t){return a.resolve([1])}},{key:"openChipPromise",value:function(e){return a.resolve([1])}},{key:"writePromise",value:function(e,t){return a.resolve(t.length).then(function(){return t.length<50&&console.log("Write: "+u.arrToString(t)),t.length})}},{key:"closePromise",value:function(e){return a.resolve(!0)}},{key:"readPromise",value:function(e,t){return a.resolve(t).then(function(){return console.log("Read: "+u.arrToString(t)),t})}}]),t}(c);t.exports=l},{"./deviceHandlerInterface":11,"./log":13,"./util":19,bluebird:1}],19:[function(e,t,r){"use strict";function n(e){return String.fromCharCode.apply(null,e)}function i(e,t){t=t||999999;for(var r="",n=0;n<e.byteLength;n++){var i=e[n];if(r+=32>i||i>127?".":String.fromCharCode(i),n>=t){r+="---LONG";break}}return r}function o(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r}function s(e,t,r){var n=e.byteLength;if(r){if(t.byteLength<n)return!1}else if(e.byteLength!==t.byteLength)return!1;for(var i=0;n>i;i++)if(e[i]!==t[i])return!1;return!0}function a(e,t){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(e,0),r.set(t,e.byteLength),r}function u(e,t,r){function n(){return i?l.resolve(!1):e()["catch"](function(e){return h.info("Error when polling. likely benign"+e),!1}).then(function(e){return e?l.resolve(e):l.delay(t).then(n)})}var i=!1;return n().timeout(r)["catch"](l.TimeoutError,function(e){throw i=!0,e})}function c(e){return[e>>16,65535&e]}var l=e("bluebird"),h=e("./log"),f=3;t.exports={arrToString:n,arrayBufferEquals:s,appendBuffer:a,pollPromise:u,stringToArr:o,arrToStringConvertNonAscii:i,magicToVidPid:c,MAX_CHIPS:f}},{"./log":13,bluebird:1}]},{},[4]);